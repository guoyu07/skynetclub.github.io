---
layout: post
title:  "linux安装skynet问题总结"
date:   2016-06-06 17:03:19
categories: skynet
tags: [skynet]
---

<div class="article_c">
<div style="font-family: 微软雅黑; font-size: 14px; line-height: 21px;">skynet是为在线游戏服务器打造的轻量级框架，使用c+lua实现，支持linux 。使用这套框架能获得很大收益，其中一个就是，基本只需要用lua开发，很少用到c，提高了开发效率。但是，skynet本身对系统有很大依赖性，安装说明过于简单，没有提及到。所以文章这里总结linux安装skynet问题，希望有所帮助。</div><div style="font-family: 微软雅黑; font-size: 14px; line-height: 21px;"><br></div><div style="font-family: 微软雅黑; font-size: 14px; line-height: 21px;">skynet的安装过程<br><table border="1" cellpadding="2" cellspacing="0" style="font-family: 微软雅黑; background-color: inherit;font-size:undefined; border-collapse: collapse; margin-top: 10px; margin-bottom: 10px; width: 600px;"><tbody style="background-color: inherit;"><tr style="background-color: inherit;"><td valign="top" style="word-break: break-all; border: 1px solid rgb(153, 153, 153); padding: 5px 10px; min-height: 25px; min-width: 25px; height: 25px; background-color: inherit; width: 579px;"><div style="min-width: 2px; background-color: inherit;"><div style="font-family: 微软雅黑; font-size: 14px; line-height: 1.5;">git clone https://github.com/cloudwu/skynet.git<br style="background-color: inherit;">cd skynet</div><div style="font-family: 微软雅黑; font-size: 14px; line-height: 1.5;">make&nbsp;linux</div></div></td></tr></tbody></table></div><div style="font-family: 微软雅黑; font-size: 14px; line-height: 21px;">简单3步，对于很多高版本的系统来说，可能就这3步。但是，低版本系统可能无法安装，如下：</div><div style="font-family: 微软雅黑; font-size: 14px; line-height: 21px;"><strong>1. gcc版本问题</strong></div><div style="font-family: 微软雅黑; font-size: 14px; line-height: 21px;">2. 缺少 readline</div><div style="font-family: 微软雅黑; font-size: 14px; line-height: 21px;">3. 缺少 ncurses</div><div style="font-family: 微软雅黑; font-size: 14px; line-height: 21px;">4. 缺少 git （非必要项，则要手动下载skynet及3rd下的jemalloc）</div><div style="font-family: 微软雅黑; font-size: 14px; line-height: 21px;">5. 缺少 autoconf</div><div style="font-family: 微软雅黑; font-size: 14px; line-height: 21px;"><br style="background-color: inherit;"></div><div style="font-family: 微软雅黑; font-size: 14px; line-height: 21px;">所以，这里以CentOS5.5系统做说明，这系统不具备以上几个条件，甚至连git都无法通过包管理来安装。在skynet的编译过程中，如果在make步骤出现错误，要用 make cleanall 清除已编译的文件，不然会出现莫名其妙的错误。</div><div style="font-family: 微软雅黑; font-size: 14px; line-height: 21px;"><div>在早期的skynet版本，lua不能清除干净，若是这样，执行：cd 3rd/lua &amp;&amp; make clean &amp;&amp; cd -</div></div><div style="font-family: 微软雅黑; font-size: 14px; line-height: 21px;"><br style="background-color: inherit;"></div><h3 style="font-family: 微软雅黑; line-height: 21px;"><span style="background-color: inherit;"><span style="font-size:24px;"><strong>问题</strong>1：缺少git</span></span></h3><div style="font-family: 微软雅黑; font-size: 14px; line-height: 21px;"><table border="1" cellpadding="2" cellspacing="0" style="font-size:undefined; border-collapse: collapse; margin-top: 10px; margin-bottom: 10px; background-color: inherit; width: 600px;"><tbody style="background-color: inherit;"><tr style="background-color: inherit;"><td valign="top" style="word-break: break-all; border: 1px solid rgb(153, 153, 153); padding: 5px 10px; min-height: 25px; min-width: 25px; height: 47px; background-color: inherit; width: 579px;"><div style="min-width: 2px; background-color: inherit;"><span style="font-family: 微软雅黑; font-size: 14px;">#&nbsp;git&nbsp;clone https://github.com/cloudwu/skynet.git</span><br style="font-family: 微软雅黑; font-size: 14px;"><span style="font-family: 微软雅黑; font-size: 14px;">bash:&nbsp;git:&nbsp;command&nbsp;not&nbsp;found</span><br style="background-color: inherit;"></div></td></tr></tbody></table></div><div style="font-family: 微软雅黑; font-size: 14px; line-height: 21px;"><span style="background-color: inherit;"><strong>解决：</strong></span></div><div style="font-family: 微软雅黑; font-size: 14px; line-height: 21px;"><div>这里要安装git，在安装git过程中，非常重要一步是安装curl，而这一步会把git所有的依赖装上，如curl和openssl，而git编译时也要找到curl库<br><table border="1" cellpadding="2" cellspacing="0" style="font-size:undefined; border-collapse: collapse; margin-top: 10px; margin-bottom: 10px; background-color: inherit; width: 600px;"><tbody style="background-color: inherit;"><tr style="background-color: inherit;"><td valign="top" style="word-break: break-all; border: 1px solid rgb(153, 153, 153); padding: 5px 10px; min-height: 25px; min-width: 25px; height: 25px; background-color: inherit; width: 579px;"><div style="min-width: 2px; background-color: inherit;"><div style="font-family: 微软雅黑; font-size: 14px; line-height: 1.5;">yum -y install curl&nbsp;curl-devel</div><div style="font-family: 微软雅黑; font-size: 14px; line-height: 1.5;">wget&nbsp;--no-check-certificate https://www.kernel.org/pub/software/scm/git/git-2.5.2.tar.gz</div><div style="font-family: 微软雅黑; font-size: 14px; line-height: 1.5;">tar -zxf<span style="background-color: inherit;">&nbsp;git-2.5.2.tar.gz</span></div><div style="font-family: 微软雅黑; font-size: 14px; line-height: 1.5;">cd<span style="background-color: inherit;">&nbsp;git-2.5.2</span></div><div style="font-family: 微软雅黑; font-size: 14px; line-height: 1.5;">./configure --prefix=/usr</div><div style="font-family: 微软雅黑; font-size: 14px; line-height: 1.5;">make</div><div style="font-family: 微软雅黑; font-size: 14px; line-height: 1.5;">make install</div></div></td></tr></tbody></table></div><br style="background-color: inherit;"></div><div style="font-family: 微软雅黑; font-size: 14px; line-height: 21px;"><br></div><h3 style="font-family: 微软雅黑; line-height: 21px;"><span style="background-color: inherit;"><span style="font-size:24px;">问题2：git https错误</span></span></h3><div style="font-family: 微软雅黑; font-size: 14px; line-height: 21px;"><table border="1" cellpadding="2" cellspacing="0" style="font-size:undefined; border-collapse: collapse; margin-top: 10px; margin-bottom: 10px; background-color: inherit; width: 600px;"><tbody style="background-color: inherit;"><tr style="background-color: inherit;"><td valign="top" style="word-break: break-all; border: 1px solid rgb(153, 153, 153); padding: 5px 10px; min-height: 25px; min-width: 25px; height: 25px; background-color: inherit; width: 579px;"><div style="min-width: 2px; background-color: inherit;"><span style="font-family: 微软雅黑; font-size: 14px;">#&nbsp;git&nbsp;clone https://github.com/cloudwu/skynet.git<br style="background-color: inherit;"></span></div><div style="min-width: 2px; background-color: inherit;"><span style="font-family: 微软雅黑; font-size: 14px;">Cloning&nbsp;into&nbsp;'skynet'...</span><br style="font-family: 微软雅黑; font-size: 14px;"><span style="font-family: 微软雅黑; font-size: 14px;">fatal:&nbsp;Unable&nbsp;to&nbsp;find&nbsp;remote&nbsp;helper&nbsp;for&nbsp;'https'</span><br style="background-color: inherit;"></div></td></tr></tbody></table></div><div style="font-family: 微软雅黑; font-size: 14px; line-height: 21px;"><span style="background-color: inherit;"><strong>解决：</strong></span></div><div style="font-family: 微软雅黑; font-size: 14px; line-height: 21px;">很多网友都是说把https换成git解决，但也只是暂时性的。<span style="background-color: inherit; line-height: 1.5;">报错是g</span><span style="background-color: inherit; line-height: 1.5;">it安装时系统缺少curl导致的，参考问题1重装git</span></div><div style="font-family: 微软雅黑; font-size: 14px; line-height: 21px;"><span style="background-color: inherit; line-height: 1.5;"><br style="background-color: inherit;"></span></div><div style="font-family: 微软雅黑; font-size: 14px; line-height: 21px;">重装git后，如果还不行，<span style="background-color: inherit; line-height: 1.5;">应该是git软连接问题，如下修正</span><span style="background-color: inherit; line-height: 1.5;">：</span></div><div style="font-family: 微软雅黑; font-size: 14px; line-height: 21px;"><span style="background-color: inherit; line-height: 1.5;">ln -sf /usr/bin/git /bin/git</span></div><div style="font-family: 微软雅黑; font-size: 14px; line-height: 21px;"><br style="background-color: inherit;"></div><div style="font-family: 微软雅黑; font-size: 14px; line-height: 21px;"><br style="background-color: inherit;"></div><h3 style="font-family: 微软雅黑; line-height: 21px;"><span style="background-color: inherit;"><span style="font-size:24px;"><strong>问题</strong>3：缺少readline</span></span></h3><div style="font-family: 微软雅黑; font-size: 14px; line-height: 21px;"><table border="1" cellpadding="2" cellspacing="0" style="font-size:undefined; border-collapse: collapse; margin-top: 10px; margin-bottom: 10px; background-color: inherit; width: 600px;"><tbody style="background-color: inherit;"><tr style="background-color: inherit;"><td valign="top" style="word-break: break-all; border: 1px solid rgb(153, 153, 153); padding: 5px 10px; min-height: 25px; min-width: 25px; height: 25px; background-color: inherit; width: 579px;"><div style="min-width: 2px; background-color: inherit;"><span style="font-family:Microsoft YaHei;font-size:14px;">lua.c:81:31: error: readline/readline.h: No such file or directory</span></div><div style="min-width: 2px; background-color: inherit;"><span style="font-family:Microsoft YaHei;font-size:14px;">lua.c:82:30: error: readline/history.h: No such file or directory</span></div><div style="min-width: 2px; background-color: inherit;"><span style="font-family:Microsoft YaHei;font-size:14px;">lua.c: In function ‘pushline’:</span></div><div style="min-width: 2px; background-color: inherit;"><span style="font-family:Microsoft YaHei;font-size:14px;">lua.c:311: warning: implicit declaration of function ‘readline’</span></div><div style="min-width: 2px; background-color: inherit;"><span style="font-family:Microsoft YaHei;font-size:14px;">lua.c:311: warning: assignment makes pointer from integer without a cast</span></div><div style="min-width: 2px; background-color: inherit;"><span style="font-family:Microsoft YaHei;font-size:14px;">lua.c: In function ‘addreturn’:</span></div><div style="min-width: 2px; background-color: inherit;"><span style="font-family:Microsoft YaHei;font-size:14px;">lua.c:342: warning: implicit declaration of function ‘add_history’</span></div><div style="min-width: 2px; background-color: inherit;"><span style="font-family:Microsoft YaHei;font-size:14px;">make[3]: *** [lua.o] Error 1</span></div><div style="min-width: 2px; background-color: inherit;"><span style="font-family:Microsoft YaHei;font-size:14px;">make[3]: Leaving directory `/data/git-2.5.2/skynet/3rd/lua'</span></div><div style="min-width: 2px; background-color: inherit;"><span style="font-family:Microsoft YaHei;font-size:14px;">make[2]: *** [linux] Error 2</span></div><div style="min-width: 2px; background-color: inherit;"><span style="font-family:Microsoft YaHei;font-size:14px;">make[2]: Leaving directory `/data/git-2.5.2/skynet/3rd/lua'</span></div><div style="min-width: 2px; background-color: inherit;"><span style="font-family:Microsoft YaHei;font-size:14px;">make[1]: *** [3rd/lua/liblua.a] Error 2</span></div><div style="min-width: 2px; background-color: inherit;"><span style="font-family:Microsoft YaHei;font-size:14px;">make[1]: Leaving directory `/data/git-2.5.2/skynet'</span></div><div style="min-width: 2px; background-color: inherit;"><span style="font-family:Microsoft YaHei;font-size:14px;">make: *** [linux] Error 2</span></div></td></tr></tbody></table></div><div style="font-family: 微软雅黑; font-size: 14px; line-height: 21px;"><span style="background-color: inherit;"><strong>解决：</strong></span><br style="background-color: inherit;"></div><div style="font-family: 微软雅黑; font-size: 14px; line-height: 21px;">yum -y install readline-devel</div><div style="font-family: 微软雅黑; font-size: 14px; line-height: 21px;"><br style="background-color: inherit;"></div><div style="font-family: 微软雅黑; font-size: 14px; line-height: 21px;"><br style="background-color: inherit;"></div><h3 style="font-family: 微软雅黑; line-height: 21px;"><span style="background-color: inherit;"><span style="font-size:24px;"><strong>问题</strong>4：缺少ncurses</span></span></h3><div style="font-family: 微软雅黑; font-size: 14px; line-height: 21px;"><table border="1" cellpadding="2" cellspacing="0" style="font-size:undefined; border-collapse: collapse; margin-top: 10px; margin-bottom: 10px; background-color: inherit; width: 600px;"><tbody style="background-color: inherit;"><tr style="background-color: inherit;"><td valign="top" style="word-break: break-all; border: 1px solid rgb(153, 153, 153); padding: 5px 10px; min-height: 25px; min-width: 25px; height: 25px; background-color: inherit; width: 579px;"><div style="min-width: 2px; background-color: inherit;"><span style="font-family:Microsoft YaHei;font-size:14px;">cc -std=gnu99 -o lua &nbsp; lua.o liblua.a -lm -Wl,-E -ldl -lreadline</span></div><div style="min-width: 2px; background-color: inherit;"><span style="font-family:Microsoft YaHei;font-size:14px;">/usr/lib/gcc/i386-redhat-linux/4.1.2/../../../libreadline.so: undefined reference to `PC'</span></div><div style="min-width: 2px; background-color: inherit;"><span style="font-family:Microsoft YaHei;font-size:14px;">/usr/lib/gcc/i386-redhat-linux/4.1.2/../../../libreadline.so: undefined reference to `tgetflag'</span></div><div style="min-width: 2px; background-color: inherit;"><span style="font-family:Microsoft YaHei;font-size:14px;">/usr/lib/gcc/i386-redhat-linux/4.1.2/../../../libreadline.so: undefined reference to `tgetent'</span></div><div style="min-width: 2px; background-color: inherit;"><span style="font-family:Microsoft YaHei;font-size:14px;">/usr/lib/gcc/i386-redhat-linux/4.1.2/../../../libreadline.so: undefined reference to `UP'</span></div><div style="min-width: 2px; background-color: inherit;"><span style="font-family:Microsoft YaHei;font-size:14px;">/usr/lib/gcc/i386-redhat-linux/4.1.2/../../../libreadline.so: undefined reference to `tputs'</span></div><div style="min-width: 2px; background-color: inherit;"><span style="font-family:Microsoft YaHei;font-size:14px;">/usr/lib/gcc/i386-redhat-linux/4.1.2/../../../libreadline.so: undefined reference to `tgoto'</span></div><div style="min-width: 2px; background-color: inherit;"><span style="font-family:Microsoft YaHei;font-size:14px;">/usr/lib/gcc/i386-redhat-linux/4.1.2/../../../libreadline.so: undefined reference to `tgetnum'</span></div><div style="min-width: 2px; background-color: inherit;"><span style="font-family:Microsoft YaHei;font-size:14px;">/usr/lib/gcc/i386-redhat-linux/4.1.2/../../../libreadline.so: undefined reference to `BC'</span></div><div style="min-width: 2px; background-color: inherit;"><span style="font-family:Microsoft YaHei;font-size:14px;">/usr/lib/gcc/i386-redhat-linux/4.1.2/../../../libreadline.so: undefined reference to `tgetstr'</span></div><div style="min-width: 2px; background-color: inherit;"><span style="font-family:Microsoft YaHei;font-size:14px;">collect2: ld returned 1 exit status</span></div><div style="min-width: 2px; background-color: inherit;"><span style="font-family:Microsoft YaHei;font-size:14px;">make[3]: *** [lua] Error 1</span></div><div style="min-width: 2px; background-color: inherit;"><span style="font-family:Microsoft YaHei;font-size:14px;">make[3]: Leaving directory `/data/skynet/3rd/lua'</span></div><div style="min-width: 2px; background-color: inherit;"><span style="font-family:Microsoft YaHei;font-size:14px;">make[2]: *** [linux] Error 2</span></div><div style="min-width: 2px; background-color: inherit;"><span style="font-family:Microsoft YaHei;font-size:14px;">make[2]: Leaving directory `/data/skynet/3rd/lua'</span></div><div style="min-width: 2px; background-color: inherit;"><span style="font-family:Microsoft YaHei;font-size:14px;">make[1]: *** [3rd/lua/liblua.a] Error 2</span></div><div style="min-width: 2px; background-color: inherit;"><span style="font-family:Microsoft YaHei;font-size:14px;">make[1]: Leaving directory `/data/skynet'</span></div><div style="min-width: 2px; background-color: inherit;"><span style="font-family:Microsoft YaHei;font-size:14px;">make: *** [linux] Error 2</span></div></td></tr></tbody></table></div><div style="font-family: 微软雅黑; font-size: 14px; line-height: 21px;"><strong>解决：<span style="font-weight: normal;"><br style="background-color: inherit;">很多网友说修改Makefile，在SYSLIBS变量中追加" -lncurses "选项，但这样不方便，以后还会遇到这个问题。所以这里建议</span><span style="font-weight: normal;">手动安装readline</span></strong></div><table border="1" cellpadding="2" cellspacing="0" style="font-size:undefined; border-collapse: collapse; margin-top: 10px; margin-bottom: 10px; font-family: 微软雅黑; width: 600px;"><tbody style="background-color: inherit;"><tr style="background-color: inherit;"><td valign="top" style="word-break: break-all; border: 1px solid rgb(153, 153, 153); padding: 5px 10px; min-height: 25px; min-width: 25px; height: 25px; background-color: inherit; width: 579px;"><div style="min-width: 2px; background-color: inherit;"><div style="font-family: 微软雅黑; font-size: 14px; line-height: 1.5;"><span style="line-height: 1.5; background-color: inherit;">yum -y install ncurses-devel</span></div><div style="font-family: 微软雅黑; font-size: 14px; line-height: 1.5;"><div>wget ftp://ftp.gnu.org/gnu/readline/readline-6.2.tar.gz</div><div>tar -zxf readline-6.2.tar.gz</div><div>cd readline-6.2</div><div>./configure --prefix=/usr</div><div>make SHLIB_LIBS=-lncurses</div><div>make install</div><div>ldconfig</div></div></div></td></tr></tbody></table><div style="font-family: 微软雅黑; font-size: 14px; line-height: 21px;"><div><strong>备注：</strong></div><div>1、国内连接gnu.org网站不是很稳定，可能wget要多试几次。</div><div>2、通过ldconfig&nbsp;-p&nbsp;|grep&nbsp;readline可以测试readline的库是否成功加载</div></div><div style="font-family: 微软雅黑; font-size: 14px; line-height: 21px;">3、如果还无法解决，执行以下命令（建议先备份下）：</div><div style="font-family: 微软雅黑; font-size: 14px; line-height: 21px;">&nbsp;&nbsp;<span style="line-height: 1.5;">rm -rf /usr/lib/libreadline*</span><div>&nbsp; ldconfig</div></div><div style="font-family: 微软雅黑; font-size: 14px; line-height: 21px;">如果是64位机器：</div><div style="font-family: 微软雅黑; font-size: 14px; line-height: 21px;">&nbsp; rm -rf /usr/lib64/libreadline*</div><div style="font-family: 微软雅黑; font-size: 14px; line-height: 21px;">&nbsp; ldconfig</div><div style="font-family: 微软雅黑; font-size: 14px; line-height: 21px;"><br style="background-color: inherit;"></div><div style="font-family: 微软雅黑; font-size: 14px; line-height: 21px;"><br style="background-color: inherit;"></div><h3 style="font-family: 微软雅黑; line-height: 21px;"><span style="background-color: inherit;"><span style="font-size:24px;"><strong>问题</strong>5：lua整数编译报错</span></span></h3><div style="font-family: 微软雅黑; font-size: 14px; line-height: 21px;"><table border="1" cellpadding="2" cellspacing="0" style="font-size:undefined; border-collapse: collapse; margin-top: 10px; margin-bottom: 10px; background-color: inherit; width: 600px;"><tbody style="background-color: inherit;"><tr style="background-color: inherit;"><td valign="top" style="word-break: break-all; border: 1px solid rgb(153, 153, 153); padding: 5px 10px; min-height: 25px; min-width: 25px; height: 25px; background-color: inherit; width: 579px;"><div style="min-width: 2px; background-color: inherit;"><span style="font-size: 14px; background-color: inherit; line-height: 21px;">3rd/lua/luaconf.h:560:2: error: #error "Compiler does not support 'long long'. Use option '-DLUA_32BITS' &nbsp; or '-DLUA_C89_NUMBERS' (see file 'luaconf.h' for details)"</span></div><div style="min-width: 2px; background-color: inherit;"><span style="font-size: 14px;">In file included from skynet-src/malloc_hook.c:5:</span></div><div style="min-width: 2px; background-color: inherit;"><span style="font-size:14px;">3rd/lua/lua.h:93: error: expected ‘=’, ‘,’, ‘;’, ‘asm’ or ‘__attribute__’ before ‘lua_Integer’</span></div><div style="min-width: 2px; background-color: inherit;"><span style="font-size:14px;">3rd/lua/lua.h:96: error: expected ‘=’, ‘,’, ‘;’, ‘asm’ or ‘__attribute__’ before ‘lua_Unsigned’</span></div><div style="min-width: 2px; background-color: inherit;"><span style="font-size:14px;">3rd/lua/lua.h:182: warning: type defaults to ‘int’ in declaration of ‘lua_Integer’</span></div><div style="min-width: 2px; background-color: inherit;"><span style="font-size:14px;">3rd/lua/lua.h:182: error: ‘lua_Integer’ declared as function returning a function</span></div><div style="min-width: 2px; background-color: inherit;"><span style="font-size:14px;">3rd/lua/lua.h:182: warning: parameter names (without types) in function declaration</span></div><div style="min-width: 2px; background-color: inherit;"><span style="font-size:14px;">3rd/lua/lua.h:226: error: expected declaration specifiers or ‘...’ before ‘lua_Integer’</span></div><div style="min-width: 2px; background-color: inherit;"><span style="font-size:14px;">3rd/lua/lua.h:244: error: expected declaration specifiers or ‘...’ before ‘lua_Integer’</span></div><div style="min-width: 2px; background-color: inherit;"><span style="font-size:14px;">3rd/lua/lua.h:246: error: expected declaration specifiers or ‘...’ before ‘lua_Integer’</span></div><div style="min-width: 2px; background-color: inherit;"><span style="font-size:14px;">3rd/lua/lua.h:261: error: expected declaration specifiers or ‘...’ before ‘lua_Integer’</span></div><div style="min-width: 2px; background-color: inherit;"><span style="font-size:14px;">3rd/lua/lua.h:263: error: expected declaration specifiers or ‘...’ before ‘lua_Integer’</span></div><div style="min-width: 2px; background-color: inherit;"><span style="font-size:14px;">skynet-src/malloc_hook.c: In function ‘update_xmalloc_stat_alloc’:</span></div><div style="min-width: 2px; background-color: inherit;"><span style="font-size:14px;">skynet-src/malloc_hook.c:55: warning: value computed is not used</span></div><div style="min-width: 2px; background-color: inherit;"><span style="font-size:14px;">skynet-src/malloc_hook.c: In function ‘update_xmalloc_stat_free’:</span></div><div style="min-width: 2px; background-color: inherit;"><span style="font-size:14px;">skynet-src/malloc_hook.c:65: warning: value computed is not used</span></div><div style="min-width: 2px; background-color: inherit;"><span style="font-size:14px;">skynet-src/malloc_hook.c: In function ‘dump_mem_lua’:</span></div><div style="min-width: 2px; background-color: inherit;"><span style="font-size:14px;">skynet-src/malloc_hook.c:237: error: too many arguments to function ‘lua_pushinteger’</span></div><div style="min-width: 2px; background-color: inherit;"><span style="font-size:14px;">skynet-src/malloc_hook.c:238: error: expected ‘)’ before ‘data’</span></div><div style="min-width: 2px; background-color: inherit;"><span style="font-size:14px;">skynet-src/malloc_hook.c:238: error: too many arguments to function ‘lua_rawseti’</span></div><div style="min-width: 2px; background-color: inherit;"><span style="font-size:14px;">In file included from skynet-src/skynet_log.c:1:</span></div><div style="min-width: 2px; background-color: inherit;"><span style="font-size:14px;">skynet-src/skynet_log.h:14:7: warning: no newline at end of file</span></div><div style="min-width: 2px; background-color: inherit;"><span style="font-size:14px;">make[1]: *** [skynet] Error 1</span></div><div style="min-width: 2px; background-color: inherit;"><span style="font-size:14px;">make[1]: Leaving directory `/data/skynet'</span></div><div style="min-width: 2px; background-color: inherit;"><span style="font-size:14px;">make: *** [linux] Error 2</span></div></td></tr></tbody></table></div><div style="font-family: 微软雅黑; font-size: 14px; line-height: 21px;"><span style="background-color: inherit;"><strong>解决：</strong></span></div><div style="font-family: 微软雅黑; font-size: 14px; line-height: 21px;">这个是skynet最常见的编译失败了，和gcc版本有关，升级gcc可以解决问题。<br style="background-color: inherit;"></div><div style="font-family: 微软雅黑; font-size: 14px; line-height: 21px;">最简单的方法：修改Makefile，在CFLAGS 加入 -std=gnu99</div><div style="font-family: 微软雅黑; font-size: 14px; line-height: 21px;">如果不想手动改，可用以下命令：</div><div style="font-family: 微软雅黑; font-size: 14px; line-height: 21px;">sed -i "s|CFLAGS =|CFLAGS = -std=gnu99 |" Makefile</div><div style="font-family: 微软雅黑; font-size: 14px; line-height: 21px;">如果是升级gcc参考问题6的解决方式。</div><div style="font-family: 微软雅黑; font-size: 14px; line-height: 21px;"><br style="background-color: inherit;"></div><div style="font-family: 微软雅黑; font-size: 14px; line-height: 21px;"><br></div><h3 style="font-family: 微软雅黑; line-height: 21px;"><span style="background-color: inherit;"><span style="font-size:24px;">问题6：gcc编译器问题</span></span></h3><div style="font-family: 微软雅黑; font-size: 14px; line-height: 21px;"><table border="1" cellpadding="2" cellspacing="0" style="font-size:undefined; border-collapse: collapse; margin-top: 10px; margin-bottom: 10px; background-color: inherit; width: 600px;"><tbody style="background-color: inherit;"><tr style="background-color: inherit;"><td valign="top" style="word-break: break-all; border: 1px solid rgb(153, 153, 153); padding: 5px 10px; min-height: 25px; min-width: 25px; height: 25px; background-color: inherit; width: 579px;"><div style="min-width: 2px; background-color: inherit;"><span style="font-size:14px;">/data/skynet/skynet-src/skynet_server.c:211: undefined reference to `__sync_sub_and_fetch_4'</span></div><div style="min-width: 2px; background-color: inherit;"><span style="font-size:14px;">/tmp/ccC4fGch.o: In function `cmd_logoff':</span></div><div style="min-width: 2px; background-color: inherit;"><span style="font-size:14px;">/data/skynet/skynet-src/skynet_server.c:589: undefined reference to `__sync_bool_compare_and_swap_4'</span></div><div style="min-width: 2px; background-color: inherit;"><span style="font-size:14px;">/tmp/ccC4fGch.o: In function `cmd_logon':</span></div><div style="min-width: 2px; background-color: inherit;"><span style="font-size:14px;">/data/skynet/skynet-src/skynet_server.c:568: undefined reference to `__sync_bool_compare_and_swap_4'</span></div><div style="min-width: 2px; background-color: inherit;"><span style="font-size:14px;">/tmp/ccaeanLP.o: In function `reserve_id':</span></div><div style="min-width: 2px; background-color: inherit;"><span style="font-size:14px;">/data/skynet/skynet-src/socket_server.c:241: undefined reference to `__sync_add_and_fetch_4'</span></div><div style="min-width: 2px; background-color: inherit;"><span style="font-size:14px;">/data/skynet/skynet-src/socket_server.c:247: undefined reference to `__sync_bool_compare_and_swap_2'</span></div><div style="min-width: 2px; background-color: inherit;"><span style="font-size:14px;">/data/skynet/skynet-src/socket_server.c:243: undefined reference to `__sync_and_and_fetch_4'</span></div><div style="min-width: 2px; background-color: inherit;"><span style="font-size:14px;">/tmp/ccs12kTV.o: In function `get_allocated_field':</span></div><div style="min-width: 2px; background-color: inherit;"><span style="font-size:14px;">/data/skynet/skynet-src/malloc_hook.c:36: undefined reference to `__sync_bool_compare_and_swap_4'</span></div><div style="min-width: 2px; background-color: inherit;"><span style="font-size:14px;">/data/skynet/skynet-src/malloc_hook.c:40: undefined reference to `__sync_bool_compare_and_swap_4'</span></div><div style="min-width: 2px; background-color: inherit;"><span style="font-size:14px;">collect2: ld returned 1 exit status</span></div><div style="min-width: 2px; background-color: inherit;"><span style="font-size:14px;">make[1]: *** [skynet] Error 1</span></div><div style="min-width: 2px; background-color: inherit;"><span style="font-size:14px;">make[1]: Leaving directory `/data/skynet'</span></div><div style="min-width: 2px; background-color: inherit;"><span style="font-size:14px;">make: *** [linux] Error 2</span></div></td></tr></tbody></table></div><div style="font-family: 微软雅黑; font-size: 14px; line-height: 21px;"><strong>解决：</strong></div><div style="font-family: 微软雅黑; font-size: 14px; line-height: 21px;">这是gcc版本问题，解决方法就是到高版本（如gcc4.5）下载一个linux_atomic.c文件，将其编译为一个静态库链接到你的项目代码，具体做法也比较麻烦。所以，这里推荐重装gcc。</div><div style="font-family: 微软雅黑; font-size: 14px; line-height: 21px;">另外，编译skynet建议gcc最低版本4.6.0，可自动下载并更新依赖包。安装gcc过程会比较久，要耐心等待</div><div style="font-family: 微软雅黑; font-size: 14px; line-height: 21px;">安装gcc步骤如下：（<span style="color:#ff0000;">确保磁盘可用空间至少4G</span>）</div><div style="font-family: 微软雅黑; font-size: 14px; line-height: 21px;"><table border="1" cellpadding="2" cellspacing="0" style="font-size:undefined; border-collapse: collapse; margin-top: 10px; margin-bottom: 10px; background-color: inherit; width: 600px;"><tbody style="background-color: inherit;"><tr style="background-color: inherit;"><td valign="top" style="word-break: break-all; border: 1px solid rgb(153, 153, 153); padding: 5px 10px; min-height: 25px; min-width: 25px; height: 25px; background-color: inherit; width: 579px;"><div style="min-width: 2px; background-color: inherit;"><div style="font-family: 微软雅黑; font-size: 14px; line-height: 1.5;">wget http://mirrors.ustc.edu.cn/gnu/gcc/gcc-4.6.0/gcc-4.6.0.tar.gz</div><div style="font-family: 微软雅黑; font-size: 14px; line-height: 1.5;">tar -zxf<span style="background-color: inherit;">&nbsp;</span>gcc-4.6.0.tar.gz</div><div style="font-family: 微软雅黑; font-size: 14px; line-height: 1.5;">cd&nbsp;gcc-4.6.0</div><div style="font-family: 微软雅黑; font-size: 14px; line-height: 1.5;">./contrib/download_prerequisites<br>mkdir build</div><div style="font-family: 微软雅黑; font-size: 14px; line-height: 1.5;">cd build</div><div style="font-family: 微软雅黑; font-size: 14px; line-height: 1.5;">../configure --prefix=/usr -enable-checking=release -enable-languages=c,c++ -disable-multilib</div><div style="font-family: 微软雅黑; font-size: 14px; line-height: 1.5;">make</div><div style="font-family: 微软雅黑; font-size: 14px; line-height: 1.5;">make install</div></div></td></tr></tbody></table></div><div style="font-family: 微软雅黑; font-size: 14px; line-height: 21px;">注意了，要确保 download_prerequisites 安装成功。因为国内连接gnu.org网站不是很稳定，可能出现类似错误：</div><div style="font-family: 微软雅黑; font-size: 14px; line-height: 21px;"><table border="1" cellpadding="2" cellspacing="0" style="font-size:undefined; border-collapse: collapse; margin-top: 10px; margin-bottom: 10px; background-color: inherit; width: 600px;"><tbody style="background-color: inherit;"><tr style="background-color: inherit;"><td valign="top" style="word-break: break-all; border: 1px solid rgb(153, 153, 153); padding: 5px 10px; min-height: 25px; min-width: 25px; height: 25px; background-color: inherit; width: 579px;"><div style="min-width: 2px; background-color: inherit;"><div style="font-family: 微软雅黑; font-size: 14px;">Resolving gcc.gnu.org... 209.132.180.131</div><div style="font-family: 微软雅黑; font-size: 14px;">Connecting to gcc.gnu.org|209.132.180.131|:21... connected.</div><div style="font-family: 微软雅黑; font-size: 14px;">Logging in as anonymous ... Logged in!</div><div style="font-family: 微软雅黑; font-size: 14px;">==&gt; SYST ... done. &nbsp; &nbsp;==&gt; PWD ... done.</div><div style="font-family: 微软雅黑; font-size: 14px;">==&gt; TYPE I ... done. &nbsp;==&gt; CWD /pub/gcc/infrastructure ... done.</div><div style="font-family: 微软雅黑; font-size: 14px;">==&gt; SIZE mpfr-2.4.2.tar.bz2 ... 1077886</div><div style="font-family: 微软雅黑; font-size: 14px;">==&gt; PASV ... couldn't connect to 209.132.180.131 port 10179: Connection refused</div></div></td></tr></tbody></table></div><div style="font-family: 微软雅黑; font-size: 14px; line-height: 21px;">如果重试了很多次都无法成功，尝试手动安装吧，主要就3个依赖gmp和mpfr、mpc，装好后再继续执行gcc ../configure及后面的步骤。</div><div style="font-family: 微软雅黑; font-size: 14px; line-height: 21px;"><table border="1" cellpadding="2" cellspacing="0" style="font-size:undefined; border-collapse: collapse; margin-top: 10px; margin-bottom: 10px; background-color: inherit; width: 600px;"><tbody style="background-color: inherit;"><tr style="background-color: inherit;"><td valign="top" style="word-break: break-all; border: 1px solid rgb(153, 153, 153); padding: 5px 10px; min-height: 25px; min-width: 25px; height: 25px; background-color: inherit; width: 579px;"><div style="min-width: 2px; background-color: inherit;"><div style="font-family: 微软雅黑; font-size: 14px; line-height: 1.5;">wget http://ftp.gnu.org/gnu/gmp/gmp-4.2.2.tar.bz2</div><div style="font-family: 微软雅黑; font-size: 14px; line-height: 1.5;">tar -jxf gmp-4.2.2.tar.bz2</div><div style="font-family: 微软雅黑; font-size: 14px; line-height: 1.5;">cd gmp-4.2.2</div><div style="font-family: 微软雅黑; font-size: 14px; line-height: 1.5;">./configure --prefix=/usr</div><div style="font-family: 微软雅黑; font-size: 14px; line-height: 1.5;">make &amp;&amp; make install</div><div style="font-family: 微软雅黑; font-size: 14px; line-height: 1.5;"><br style="background-color: inherit;"></div><div style="font-family: 微软雅黑; font-size: 14px; line-height: 1.5;">wget http://mpfr.loria.fr/mpfr-2.3.2/mpfr-2.3.2.tar.gz</div><div style="font-family: 微软雅黑; font-size: 14px; line-height: 1.5;">tar -zxf mpfr-2.3.2.tar.gz</div><div style="font-family: 微软雅黑; font-size: 14px; line-height: 1.5;">cd mpfr-2.3.2</div><div style="font-family: 微软雅黑; font-size: 14px; line-height: 1.5;">./configure --prefix=/usr</div><div style="font-family: 微软雅黑; font-size: 14px; line-height: 1.5;">make &amp;&amp; make install</div><div style="font-family: 微软雅黑; font-size: 14px; line-height: 1.5;"><br style="background-color: inherit;"></div><div style="font-family: 微软雅黑; font-size: 14px; line-height: 1.5;"><div>wget ftp://gcc.gnu.org/pub/gcc/infrastructure/mpc-0.8.1.tar.gz</div><div>tar -zxf<span style="background-color: inherit;">&nbsp;</span>mpc-0.8.1.tar.gz</div><div>cd&nbsp;mpc-0.8.1<br style="background-color: inherit;">./configure --prefix=/usr<div>make &amp;&amp; make install</div></div></div></div></td></tr></tbody></table></div><div style="font-family: 微软雅黑; font-size: 14px; line-height: 21px;"><br style="background-color: inherit;"></div><div style="font-family: 微软雅黑; font-size: 14px; line-height: 21px;"><br></div><h3 style="font-family: 微软雅黑; line-height: 21px;"><span style="background-color: inherit;"><span style="font-size:24px;">问题7：缺少autoconf</span></span></h3><div style="font-family: 微软雅黑; font-size: 14px; line-height: 21px;"><table border="1" cellpadding="2" cellspacing="0" style="font-size:undefined; border-collapse: collapse; margin-top: 10px; margin-bottom: 10px;"><tbody style="background-color: inherit;"><tr style="background-color: inherit;"><td valign="top" style="word-break: break-all; border: 1px solid rgb(153, 153, 153); padding: 5px 10px; min-height: 25px; min-width: 25px; height: 25px; background-color: inherit; width: 579px;"><div style="min-width: 2px; background-color: inherit;"><span style="font-size:14px;">make all PLAT=linux SKYNET_LIBS="-lpthread -lm -ldl -lrt" SHARED="-fPIC --shared" EXPORT="-Wl,-E" MALLOC_STATICLIB="3rd/jemalloc/lib/libjemalloc_pic.a" SKYNET_DEFINES=""</span></div><div style="min-width: 2px; background-color: inherit;"><span style="font-size:14px;">make[1]: Entering directory `/data/skynet'</span></div><div style="min-width: 2px; background-color: inherit;"><span style="font-size:14px;">cd 3rd/jemalloc &amp;&amp; ./autogen.sh --with-jemalloc-prefix=je_ --disable-valgrind</span></div><div style="min-width: 2px; background-color: inherit;"><span style="font-size:14px;">autoconf</span></div><div style="min-width: 2px; background-color: inherit;"><span style="font-size:14px;">./autogen.sh: line 5: autoconf: command not found</span></div><div style="min-width: 2px; background-color: inherit;"><span style="font-size:14px;">Error 0 in autoconf</span></div><div style="min-width: 2px; background-color: inherit;"><span style="font-size:14px;">make[1]: *** [3rd/jemalloc/Makefile] Error 1</span></div><div style="min-width: 2px; background-color: inherit;"><span style="font-size:14px;">make[1]: Leaving directory `/data/skynet'</span></div><div style="min-width: 2px; background-color: inherit;"><span style="font-size:14px;">make: *** [linux] Error 2</span></div></td></tr></tbody></table>解决：</div><div style="font-family: 微软雅黑; font-size: 14px; line-height: 21px;">yum -y install autoconf</div><div style="font-family: 微软雅黑; font-size: 14px; line-height: 21px;"><br style="background-color: inherit;"></div><div style="font-family: 微软雅黑; font-size: 14px; line-height: 21px;"><br></div><h3 style="font-family: 微软雅黑;"><span style="background-color: inherit;"><span style="font-size: 24px;"><span style="line-height: 21px;">问题8：</span><span style="line-height: 36px;">链接错误</span></span></span></h3><div style="font-family: 微软雅黑; line-height: 21px;"><table border="1" cellpadding="2" cellspacing="0" style="font-size:undefined; border-collapse: collapse; margin-top: 10px; margin-bottom: 10px;"><tbody style="background-color: inherit;"><tr style="background-color: inherit;"><td valign="top" style="word-break: break-all; border: 1px solid rgb(153, 153, 153); padding: 5px 10px; min-height: 25px; min-width: 25px; height: 25px; background-color: inherit; width: 579px;"><div style="min-width: 2px; background-color: inherit;"><span style="font-size:14px;">ln -sf libjemalloc.so.2 lib/libjemalloc.so</span></div><div style="min-width: 2px; background-color: inherit;"><span style="font-size:14px;">ln: creating symbolic link `lib/libjemalloc.so' to `libjemalloc.so.2': Operation not supported</span></div><div style="min-width: 2px; background-color: inherit;"><span style="font-size:14px;">make[3]: *** [lib/libjemalloc.so] Error 1</span></div><div style="min-width: 2px; background-color: inherit;"><span style="font-size:14px;">make[3]: Leaving directory `/mnt/hgfs/vm/skynet/3rd/jemalloc'</span></div><div style="min-width: 2px; background-color: inherit;"><span style="font-size:14px;">make[2]: *** [3rd/jemalloc/lib/libjemalloc_pic.a] Error 2</span></div><div style="min-width: 2px; background-color: inherit;"><span style="font-size:14px;">make[2]: Leaving directory `/mnt/hgfs/vm/skynet'</span></div><div style="min-width: 2px; background-color: inherit;"><span style="font-size:14px;">make[1]: *** [linux] Error 2</span></div><div style="min-width: 2px; background-color: inherit;"><span style="font-size:14px;">make[1]: Leaving directory `/mnt/hgfs/vm/skynet'</span></div><div style="min-width: 2px; background-color: inherit;"><span style="font-size:14px;">make: *** [default] Error 2</span></div></td></tr></tbody></table><span style="font-size: 14px; background-color: inherit;"><strong>解决：</strong></span></div><div style="font-family: 微软雅黑; font-size: 14px; line-height: 21px;"><span style="line-height: 1.5;">虚拟机共享目录不能设置软连接，选择其他目录安装</span><br style="background-color: inherit;"></div><div style="font-family: 微软雅黑; font-size: 14px; line-height: 21px;"><span style="line-height: 1.5;"><br></span></div><div style="font-family: 微软雅黑; font-size: 14px; line-height: 21px;"><span style="line-height: 1.5;"><br></span></div><h3 style="font-family: 微软雅黑; line-height: 21px;"><span style="line-height: 1.5;"><span style="font-size:24px;">最后语</span></span></h3><div style="font-family: 微软雅黑; font-size: 14px; line-height: 21px;"><span style="line-height: 1.5;">如果还遇到其他错误，可以评论一起讨论，正好我也一起整理下。另外，文章看似在总结linux安装skynet遇到的问题，实际上也讨论了lua5.3的安装问题，以及gcc安装问题，希望有所帮助。</span></div><div style="font-family: 微软雅黑; font-size: 14px; line-height: 21px;"><span style="line-height: 1.5;"><br></span></div><div style="font-family: 微软雅黑; font-size: 14px; line-height: 21px;"><span style="line-height: 1.5;">2015/9/25 调整问题的排版顺序，方便阅读</span></div><div style="font-family: 微软雅黑; font-size: 14px; line-height: 21px;">参考：http://blog.csdn.net/mycwq/article/details/48690915</div> </div>

原文：http://blog.csdn.net/mycwq/article/details/48690915