---
layout: post
title:  "skynet 控制台管理使用技巧"
date:   2016-06-06 16:03:19
categories: skynet
tags: [skynet]
---

<div class="article_c">
<div style="font-family: 微软雅黑; font-size: 14px; line-height: 21px; widows: auto;">skynet 自带了一个控制台服务，可以很方便获取和调试 skynet 运行数据，而且可以热更新代码，所以，弄明白skynet控制台管理可以让你更好地使用skynet，甚至改进这个控制台服务，以满足不同业务需求。</div><div style="font-family: 微软雅黑; font-size: 14px; line-height: 21px; widows: auto;"><br></div><div style="font-family: 微软雅黑; font-size: 14px; line-height: 21px; widows: auto;">这<span style="widows: auto;">个服务默认不会启动，需要你手动启动它，如下：</span></div><div style="font-family: 微软雅黑; font-size: 14px; line-height: 21px; widows: auto;">skynet.newservice("debug_console", 8000)</div><div style="font-family: 微软雅黑; font-size: 14px; line-height: 21px; widows: auto;"><br style="background-color: inherit;"></div><div style="font-family: 微软雅黑; font-size: 14px; line-height: 21px; widows: auto;">设计原因，调试控制台只监听本地地址 127.0.0.1 ，如果需要远程使用，需要先登录到本机，然后再连接。</div><div style="font-family: 微软雅黑; font-size: 14px; line-height: 21px; widows: auto;"><br style="background-color: inherit;"></div><div style="font-family: 微软雅黑; font-size: 14px; line-height: 21px; widows: auto;">使用时，通过 telnet 或 nc 登录调试控制台，启动后显示：</div><div style="font-family: 微软雅黑; font-size: 14px; line-height: 21px; widows: auto;">$ nc 127.0.0.1 8000</div><div style="font-family: 微软雅黑; font-size: 14px; line-height: 21px; widows: auto;">Welcome to skynet console</div><div style="font-family: 微软雅黑; font-size: 14px; line-height: 21px; widows: auto;">表示连接成功。</div><div style="font-family: 微软雅黑; font-size: 14px; line-height: 21px; widows: auto;"><br style="background-color: inherit;"></div><div style="font-family: 微软雅黑; font-size: 14px; line-height: 21px; widows: auto;">注：skynet控制台不能使用上下键回溯历史命令，退格键也不能使用（改用删除键）等<span style="line-height: 1.5;">等</span>，这是<span style="line-height: 1.5; background-color: inherit;">由于 skynet 使用了自己的 IO 库，很难<span style="line-height: 1.5;">接入</span>&nbsp;libreadline （不能在 readline 的 hook 中 yield）。如果希望在控制台中使用 readline 的 history 等特性，可以自己使用 rlwrap 。</span></div><div style="font-family: 微软雅黑; font-size: 14px; line-height: 21px; widows: auto;"><br style="background-color: inherit;"></div><div style="font-family: 微软雅黑; font-size: 14px; line-height: 21px; widows: auto;">这时，你可以输入调试指令，输入 help 可以列出目前支持的所有指令。（不同版本结果不同）</div><div style="font-family: 微软雅黑; font-size: 14px; line-height: 21px; widows: auto;"><table border="1" cellpadding="2" cellspacing="0" style="font-size:undefined; border-collapse: collapse; margin-top: 10px; margin-bottom: 10px; width: 600px; background-color: inherit;"><tbody style="background-color: inherit;"><tr style="background-color: inherit;"><td valign="top" style="word-break: break-all; border: 1px solid rgb(153, 153, 153); padding: 5px 10px; min-height: 25px; min-width: 25px; height: 25px; background-color: inherit; width: 579px;"><div style="min-width: 2px; background-color: inherit;"><div style="widows: auto; font-family: 微软雅黑; font-size: 14px; line-height: 21px;">$ nc 127.0.0.1 8000</div><div style="widows: auto; font-family: 微软雅黑; font-size: 14px; line-height: 21px;">Welcome to skynet console</div></div><div style="min-width: 2px; background-color: inherit;"><span style="font-size:14px;">help</span></div><div style="min-width: 2px; background-color: inherit;"><span style="font-size:14px;">clearcache &nbsp; &nbsp; &nbsp;clear lua code cache</span></div><div style="min-width: 2px; background-color: inherit;"><span style="font-size:14px;">cmem &nbsp; &nbsp;Show C memory info</span></div><div style="min-width: 2px; background-color: inherit;"><span style="font-size:14px;">debug &nbsp; debug address : debug a lua service</span></div><div style="min-width: 2px; background-color: inherit;"><span style="font-size:14px;">exit &nbsp; &nbsp;exit address : kill a lua service</span></div><div style="min-width: 2px; background-color: inherit;"><span style="font-size:14px;">gc &nbsp; &nbsp; &nbsp;gc : force every lua service do garbage collect</span></div><div style="min-width: 2px; background-color: inherit;"><span style="font-size:14px;">help &nbsp; &nbsp;This help message</span></div><div style="min-width: 2px; background-color: inherit;"><span style="font-size:14px;">info &nbsp; &nbsp;Info address : get service infomation</span></div><div style="min-width: 2px; background-color: inherit;"><span style="font-size:14px;">inject &nbsp;inject address luascript.lua</span></div><div style="min-width: 2px; background-color: inherit;"><span style="font-size:14px;">kill &nbsp; &nbsp;kill address : kill service</span></div><div style="min-width: 2px; background-color: inherit;"><span style="font-size:14px;">list &nbsp; &nbsp;List all the service</span></div><div style="min-width: 2px; background-color: inherit;"><span style="font-size:14px;">logoff &nbsp;logoff address</span></div><div style="min-width: 2px; background-color: inherit;"><span style="font-size:14px;">logon &nbsp; logon address</span></div><div style="min-width: 2px; background-color: inherit;"><span style="font-size:14px;">mem &nbsp; &nbsp; mem : show memory status</span></div><div style="min-width: 2px; background-color: inherit;"><span style="font-size:14px;">service List unique service</span></div><div style="min-width: 2px; background-color: inherit;"><span style="font-size:14px;">signal &nbsp;signal address sig</span></div><div style="min-width: 2px; background-color: inherit;"><span style="font-size:14px;">snax &nbsp; &nbsp;lanuch a new snax service</span></div><div style="min-width: 2px; background-color: inherit;"><span style="font-size:14px;">start &nbsp; lanuch a new lua service</span></div><div style="min-width: 2px; background-color: inherit;"><span style="font-size:14px;">stat &nbsp; &nbsp;Dump all stats</span></div><div style="min-width: 2px; background-color: inherit;"><span style="font-size:14px;">task &nbsp; &nbsp;task address : show service task detail</span></div></td></tr></tbody></table></div><div style="font-family: 微软雅黑; font-size: 14px; line-height: 21px; widows: auto;"><span style="background-color: inherit; line-height: 1.5;">命令的一般格式是 命令 地址 ，有些命令不带地址，会针对所有的服务。当输入地址时，可以使用 :01000001 这样的格式指代一个服务地址：由冒号开头的 8 位 16 进制数字，也可以省略前面两个数字的 harbor id 以及接下来的连续 0 ，比如 :01000001 可以简写为 1 。所有活动的服务可以输入 list 列出。</span></div><div style="font-family: 微软雅黑; font-size: 14px; line-height: 21px; widows: auto;"><br style="background-color: inherit;"></div><div style="font-family: 微软雅黑; font-size: 14px; line-height: 21px; widows: auto;"><strong>常用的通用指令：</strong></div><div style="font-family: 微软雅黑; font-size: 14px; line-height: 21px; widows: auto;">list 列出所有服务，以及服务的<span style="line-height: 1.5;">启动</span>参数。</div><div style="font-family: 微软雅黑; font-size: 14px; line-height: 21px; widows: auto;">gc 对所有 lua 服务执行gc，并列出gc后所有服务的内存情况。</div><div style="font-family: 微软雅黑; font-size: 14px; line-height: 21px; widows: auto;">mem 列出所有 lua 服务的内存占用情况。（注：只获取 lua 服务的 lua vm 内存占用情况，如果需要 C 模块中内存使用情况，使用cmem。）</div><div style="font-family: 微软雅黑; font-size: 14px; line-height: 21px; widows: auto;">stat 列出所有 lua 服务的消息队列长度，以及被挂起的请求（协程）数量。</div><div style="font-family: 微软雅黑; font-size: 14px; line-height: 21px; widows: auto;">service 列出所有的唯一 lua 服务。</div><div style="font-family: 微软雅黑; font-size: 14px; line-height: 21px; widows: auto;">注意，由于这些指令是逐个向每个服务发送消息并等待回应，所以当某个 lua 服务过载时，可能需要等待很长时间才有返回。</div><div style="font-family: 微软雅黑; font-size: 14px; line-height: 21px; widows: auto;"><br style="background-color: inherit;"></div><div style="font-family: 微软雅黑; font-size: 14px; line-height: 21px; widows: auto;"><strong>针对单个 lua 服务的指令：</strong></div><div style="font-family: 微软雅黑; font-size: 14px; line-height: 21px; widows: auto;">exit address 退出指定 lua 服务</div><div style="font-family: 微软雅黑; font-size: 14px; line-height: 21px; widows: auto;">kill address 强制中止指定 lua 服务。</div><div style="font-family: 微软雅黑; font-size: 14px; line-height: 21px; widows: auto;">info address 让指定 lua 服务输出自己的内部信息（数据通过回调服务内 skynet.info_func 生成）</div><div style="font-family: 微软雅黑; font-size: 14px; line-height: 21px; widows: auto;">signal address sig 向服务发送一个信号，sig 默认为 0 。当一个服务陷入死循环时，默认信号会打断正在执行的 lua 字节码，并抛出 error 显示调用栈。这是针对 endless loop 的 log 的有效调试方法。（注：这里的信号并非系统信号。）</div><div style="font-family: 微软雅黑; font-size: 14px; line-height: 21px; widows: auto;">task address 显示一个服务中所有被挂起的请求的调用栈。</div><div style="font-family: 微软雅黑; font-size: 14px; line-height: 21px; widows: auto;">debug address 针对一个 lua 服务启动内置的单步调试器。http://blog.codingnow.com/2015/02/skynet_debugger.html</div><div style="font-family: 微软雅黑; font-size: 14px; line-height: 21px; widows: auto;">logon/logoff address 记录一个服务所有的输入消息（source, type, session, data, size）到文件。（生成文件的路径地址取配置 logpath） 。</div><div style="font-family: 微软雅黑; font-size: 14px; line-height: 21px; widows: auto;">inject address script 将 script 对应的脚本插入到指定服务中运行（通常可用于热更新补丁）。</div><div style="font-family: 微软雅黑; font-size: 14px; line-height: 21px; widows: auto;"><br style="background-color: inherit;"></div><div style="font-family: 微软雅黑; font-size: 14px; line-height: 21px; widows: auto;"><br style="background-color: inherit;"></div><div style="font-family: 微软雅黑; font-size: 14px; line-height: 21px; widows: auto;">这里重点说下&nbsp;<span style="line-height: 1.5;">info address 和&nbsp;<span style="line-height: 1.5;">inject address script，这两个命令很重要。</span></span></div><div style="font-family: 微软雅黑; font-size: 14px; line-height: 21px; widows: auto;"><br style="background-color: inherit;"></div><h2 style="font-family: 微软雅黑; line-height: 21px; widows: auto;"><span style="line-height: 1.5;">获取服务内部数据 - info address<span style="background-color: inherit;">&nbsp;</span></span></h2><div style="font-family: 微软雅黑; font-size: 14px; line-height: 21px; widows: auto;"><span style="line-height: 1.5;"><span style="background-color: inherit;"><span style="line-height: 1.5;">前面提到，这个命令让指定 lua 服务<span style="line-height: 1.5;">输出</span>自己的内部信息，数据<span style="line-height: 1.5;">通过回调服务内 skynet.info_func 生成。</span></span></span></span></div><div style="font-family: 微软雅黑; font-size: 14px; line-height: 21px; widows: auto;"><span style="line-height: 1.5;"><span style="background-color: inherit;"><span style="line-height: 1.5;"><span style="line-height: 1.5;">下面以 example/simpledb.lua做说明，这是个典型的skynet服务。</span></span></span></span><br style="background-color: inherit;"></div><div style="font-family: 微软雅黑; font-size: 14px; line-height: 21px; widows: auto;"></div><div style="font-family: 微软雅黑; font-size: 14px; line-height: 21px; widows: auto;"><span style="line-height: 1.5;"><span style="background-color: inherit;"><span style="line-height: 1.5;"><span style="line-height: 1.5;"></span></span></span></span><pre name="code" class="plain" style="width: 100%; overflow: hidden;">local skynet = require "skynet"
require "skynet.manager"	-- import skynet.register
local db = {}

local command = {}

function command.GET(key)
  return db[key]
end

function command.SET(key, value)
  local last = db[key]
  db[key] = value
  return last
end

-- 新增的代码 -- start
skynet.info_func(function() return "hello mycwq!" end)
-- 新增的代码 -- end


skynet.start(function()
  skynet.dispatch("lua", function(session, address, cmd, ...)
    local f = command[string.upper(cmd)]
    if f then
      skynet.ret(skynet.pack(f(...)))
    else
      error(string.format("Unknown command %s", tostring(cmd)))
    end
  end)
  skynet.register "SIMPLEDB"
end)</pre><span style="line-height: 1.5; widows: auto;"><span style="background-color: inherit;"><span style="line-height: 1.5;"><span style="line-height: 1.5;">启动example例子，</span></span></span></span><span style="line-height: 1.5; widows: auto;">连接控制台，</span></div><div style="font-family: 微软雅黑; font-size: 14px; line-height: 21px; widows: auto;"><table border="1" cellpadding="2" cellspacing="0" style="font-size:undefined; border-collapse: collapse; margin-top: 10px; margin-bottom: 10px; width: 600px; background-color: inherit;"><tbody style="background-color: inherit;"><tr style="background-color: inherit;"><td valign="top" style="word-break: break-all; border: 1px solid rgb(153, 153, 153); padding: 5px 10px; min-height: 25px; min-width: 25px; height: 25px; background-color: inherit; width: 579px;"><div style="min-width: 2px; background-color: inherit;"><div style="font-family: 微软雅黑; font-size: 14px; line-height: 1.5;"><span style="line-height: 1.5;">$ nc 127.0.0.1 8000</span></div><div style="font-family: 微软雅黑; font-size: 14px; line-height: 1.5;"><span style="line-height: 1.5;"><span style="background-color: inherit;"><span style="line-height: 1.5;"><span style="line-height: 1.5;"><span style="line-height: 1.5;">Welcome to skynet console</span><br style="background-color: inherit;"></span></span></span></span></div><div style="font-family: 微软雅黑; font-size: 14px; line-height: 1.5;"><span style="line-height: 1.5;"><span style="background-color: inherit;"><span style="line-height: 1.5;"><span style="line-height: 1.5;"><span style="line-height: 1.5;">list</span></span></span></span></span></div><div style="font-family: 微软雅黑; font-size: 14px; line-height: 1.5;"><span style="line-height: 1.5;"><span style="background-color: inherit;"><span style="line-height: 1.5;"><span style="line-height: 1.5;"><span style="line-height: 1.5;">:00000004 &nbsp; &nbsp; &nbsp; snlua cmaster</span></span></span></span></span></div><div style="font-family: 微软雅黑; font-size: 14px; line-height: 1.5;"><span style="line-height: 1.5;"><span style="background-color: inherit;"><span style="line-height: 1.5;"><span style="line-height: 1.5;"><span style="line-height: 1.5;">:00000005 &nbsp; &nbsp; &nbsp; snlua cslave</span></span></span></span></span></div><div style="font-family: 微软雅黑; font-size: 14px; line-height: 1.5;"><span style="line-height: 1.5;"><span style="background-color: inherit;"><span style="line-height: 1.5;"><span style="line-height: 1.5;"><span style="line-height: 1.5;">:00000007 &nbsp; &nbsp; &nbsp; snlua datacenterd</span></span></span></span></span></div><div style="font-family: 微软雅黑; font-size: 14px; line-height: 1.5;"><span style="line-height: 1.5;"><span style="background-color: inherit;"><span style="line-height: 1.5;"><span style="line-height: 1.5;"><span style="line-height: 1.5;">:00000008 &nbsp; &nbsp; &nbsp; snlua service_mgr</span></span></span></span></span></div><div style="font-family: 微软雅黑; font-size: 14px; line-height: 1.5;"><span style="line-height: 1.5;"><span style="background-color: inherit;"><span style="line-height: 1.5;"><span style="line-height: 1.5;"><span style="line-height: 1.5;">:0000000a &nbsp; &nbsp; &nbsp; snlua protoloader</span></span></span></span></span></div><div style="font-family: 微软雅黑; font-size: 14px; line-height: 1.5;"><span style="line-height: 1.5;"><span style="background-color: inherit;"><span style="line-height: 1.5;"><span style="line-height: 1.5;"><span style="line-height: 1.5;">:0000000b &nbsp; &nbsp; &nbsp; snlua console</span></span></span></span></span></div><div style="font-family: 微软雅黑; font-size: 14px; line-height: 1.5;"><span style="line-height: 1.5;"><span style="background-color: inherit;"><span style="line-height: 1.5;"><span style="line-height: 1.5;"><span style="line-height: 1.5;">:0000000c &nbsp; &nbsp; &nbsp; snlua debug_console 8000</span></span></span></span></span></div><div style="font-family: 微软雅黑; font-size: 14px; line-height: 1.5;"><span style="line-height: 1.5;"><span style="background-color: inherit;"><span style="line-height: 1.5;"><span style="line-height: 1.5;"><span style="line-height: 1.5;">:0000000d &nbsp; &nbsp; &nbsp; snlua simpledb</span></span></span></span></span></div><div style="font-family: 微软雅黑; font-size: 14px; line-height: 1.5;"><span style="line-height: 1.5;"><span style="background-color: inherit;"><span style="line-height: 1.5;"><span style="line-height: 1.5;"><span style="line-height: 1.5;">:0000000e &nbsp; &nbsp; &nbsp; snlua watchdog</span></span></span></span></span></div><div style="font-family: 微软雅黑; font-size: 14px; line-height: 1.5;"><span style="line-height: 1.5;"><span style="background-color: inherit;"><span style="line-height: 1.5;"><span style="line-height: 1.5;"><span style="line-height: 1.5;">:0000000f &nbsp; &nbsp; &nbsp; snlua gate</span></span></span></span></span></div><div style="font-family: 微软雅黑; font-size: 14px; line-height: 1.5;"><span style="line-height: 1.5;"><span style="background-color: inherit;"><span style="line-height: 1.5;"><span style="line-height: 1.5;"><span style="line-height: 1.5;">OK</span></span></span></span></span></div><div style="font-family: 微软雅黑; font-size: 14px; line-height: 1.5;"><span style="line-height: 1.5;"><span style="background-color: inherit;"><span style="line-height: 1.5;"><span style="line-height: 1.5;"><span style="line-height: 1.5;">info<span style="background-color: inherit;">&nbsp;</span><span style="line-height: 1.5;">:0000000d</span></span></span></span></span></span></div><div style="font-family: 微软雅黑; font-size: 14px; line-height: 1.5;"><span style="line-height: 1.5;"><span style="background-color: inherit;"><span style="line-height: 1.5;"><span style="line-height: 1.5;"><span style="line-height: 1.5;"><span style="line-height: 1.5;">hello mycwq!</span></span></span></span></span></span></div></div></td></tr></tbody></table></div><div style="font-family: 微软雅黑; font-size: 14px; line-height: 21px; widows: auto;"><span style="line-height: 1.5;"><span style="background-color: inherit;"><br style="background-color: inherit;"></span></span></div><h2 style="font-family: 微软雅黑;  line-height: 21px; widows: auto;"><span style="line-height: 1.5;"><span style="background-color: inherit;"><span style="line-height: 1.5;">代码热更新 - inject address script</span></span></span></h2><div style="font-family: 微软雅黑; font-size: 14px; line-height: 21px; widows: auto;"><span style="line-height: 1.5;"><span style="background-color: inherit;"><span style="line-height: 1.5;"><span style="line-height: 1.5;">前面提到，这个命令<span style="line-height: 1.5;">将 script 对应的脚本插入到指定服务中运行</span></span><br style="background-color: inherit;"></span></span></span></div><div style="font-family: 微软雅黑; font-size: 14px; line-height: 21px; widows: auto;"><span style="line-height: 1.5;">下面写个简单的inject例子，保存为 example/inject_simpledb.lua</span></div><div style="font-family: 微软雅黑; font-size: 14px; line-height: 21px; widows: auto;"><span style="line-height: 1.5; widows: auto;"><span style="background-color: inherit;"><span style="line-height: 1.5;"><span style="line-height: 1.5;"></span></span></span></span><pre name="code" class="plain" style="width: 100%; overflow: hidden;">if not _P then
  print "inject error!!"
  return
end
local command = _P.lua.command
command.TEST = function() return "TEST" end

print "inject ok!"</pre><span style="line-height: 1.5; widows: auto;"><span style="background-color: inherit;"><span style="line-height: 1.5;"><span style="line-height: 1.5;">启动example例子，</span></span></span></span><span style="line-height: 1.5; widows: auto;">连接控制台，</span></div><div style="font-family: 微软雅黑; font-size: 14px; line-height: 21px; widows: auto;"><table border="1" cellpadding="2" cellspacing="0" style="font-size:undefined; border-collapse: collapse; margin-top: 10px; margin-bottom: 10px; width: 600px; background-color: inherit;"><tbody style="background-color: inherit;"><tr style="background-color: inherit;"><td valign="top" style="word-break: break-all; border: 1px solid rgb(153, 153, 153); padding: 5px 10px; min-height: 25px; min-width: 25px; height: 25px; background-color: inherit; width: 579px;"><div style="min-width: 2px; font-family: 微软雅黑; font-size: 14px; line-height: 1.5;"><span style="line-height: 1.5;">$ nc 127.0.0.1 8000</span></div><div style="min-width: 2px; font-family: 微软雅黑; font-size: 14px; line-height: 1.5;"><span style="line-height: 1.5;"><span style="background-color: inherit;"><span style="line-height: 1.5;"><span style="line-height: 1.5;"><span style="line-height: 1.5;">Welcome to skynet console</span><br style="background-color: inherit;"></span></span></span></span></div><div style="min-width: 2px; font-family: 微软雅黑; font-size: 14px; line-height: 1.5;"><span style="line-height: 1.5;"><span style="background-color: inherit;"><span style="line-height: 1.5;"><span style="line-height: 1.5;"><span style="line-height: 1.5;">list</span></span></span></span></span></div><div style="min-width: 2px; font-family: 微软雅黑; font-size: 14px; line-height: 1.5;"><span style="line-height: 1.5;"><span style="background-color: inherit;"><span style="line-height: 1.5;"><span style="line-height: 1.5;"><span style="line-height: 1.5;">:00000004 &nbsp; &nbsp; &nbsp; snlua cmaster</span></span></span></span></span></div><div style="min-width: 2px; font-family: 微软雅黑; font-size: 14px; line-height: 1.5;"><span style="line-height: 1.5;"><span style="background-color: inherit;"><span style="line-height: 1.5;"><span style="line-height: 1.5;"><span style="line-height: 1.5;">:00000005 &nbsp; &nbsp; &nbsp; snlua cslave</span></span></span></span></span></div><div style="min-width: 2px; font-family: 微软雅黑; font-size: 14px; line-height: 1.5;"><span style="line-height: 1.5;"><span style="background-color: inherit;"><span style="line-height: 1.5;"><span style="line-height: 1.5;"><span style="line-height: 1.5;">:00000007 &nbsp; &nbsp; &nbsp; snlua datacenterd</span></span></span></span></span></div><div style="min-width: 2px; font-family: 微软雅黑; font-size: 14px; line-height: 1.5;"><span style="line-height: 1.5;"><span style="background-color: inherit;"><span style="line-height: 1.5;"><span style="line-height: 1.5;"><span style="line-height: 1.5;">:00000008 &nbsp; &nbsp; &nbsp; snlua service_mgr</span></span></span></span></span></div><div style="min-width: 2px; font-family: 微软雅黑; font-size: 14px; line-height: 1.5;"><span style="line-height: 1.5;"><span style="background-color: inherit;"><span style="line-height: 1.5;"><span style="line-height: 1.5;"><span style="line-height: 1.5;">:0000000a &nbsp; &nbsp; &nbsp; snlua protoloader</span></span></span></span></span></div><div style="min-width: 2px; font-family: 微软雅黑; font-size: 14px; line-height: 1.5;"><span style="line-height: 1.5;"><span style="background-color: inherit;"><span style="line-height: 1.5;"><span style="line-height: 1.5;"><span style="line-height: 1.5;">:0000000b &nbsp; &nbsp; &nbsp; snlua console</span></span></span></span></span></div><div style="min-width: 2px; font-family: 微软雅黑; font-size: 14px; line-height: 1.5;"><span style="line-height: 1.5;"><span style="background-color: inherit;"><span style="line-height: 1.5;"><span style="line-height: 1.5;"><span style="line-height: 1.5;">:0000000c &nbsp; &nbsp; &nbsp; snlua debug_console 8000</span></span></span></span></span></div><div style="min-width: 2px; font-family: 微软雅黑; font-size: 14px; line-height: 1.5;"><span style="line-height: 1.5;"><span style="background-color: inherit;"><span style="line-height: 1.5;"><span style="line-height: 1.5;"><span style="line-height: 1.5;">:0000000d &nbsp; &nbsp; &nbsp; snlua simpledb</span></span></span></span></span></div><div style="min-width: 2px; font-family: 微软雅黑; font-size: 14px; line-height: 1.5;"><span style="line-height: 1.5;"><span style="background-color: inherit;"><span style="line-height: 1.5;"><span style="line-height: 1.5;"><span style="line-height: 1.5;">:0000000e &nbsp; &nbsp; &nbsp; snlua watchdog</span></span></span></span></span></div><div style="min-width: 2px; font-family: 微软雅黑; font-size: 14px; line-height: 1.5;"><span style="line-height: 1.5;"><span style="background-color: inherit;"><span style="line-height: 1.5;"><span style="line-height: 1.5;"><span style="line-height: 1.5;">:0000000f &nbsp; &nbsp; &nbsp; snlua gate</span></span></span></span></span></div><div style="min-width: 2px; font-family: 微软雅黑; font-size: 14px; line-height: 1.5;"><span style="line-height: 1.5;"><span style="background-color: inherit;"><span style="line-height: 1.5;"><span style="line-height: 1.5;"><span style="line-height: 1.5;">OK</span></span></span></span></span></div><div style="min-width: 2px; font-family: 微软雅黑; font-size: 14px; line-height: 1.5;">inject&nbsp;<span style="line-height: 1.5;">:0000000d&nbsp;<span style="line-height: 1.5;">example/inject_simpledb.lua</span></span></div><div style="min-width: 2px; font-family: 微软雅黑; font-size: 14px; line-height: 1.5;"><span style="line-height: 1.5;"><span style="line-height: 1.5;"><span style="line-height: normal;"></span><span style="line-height: normal;">inject ok!</span><span style="line-height: normal;"></span></span></span></div></td></tr></tbody></table></div><div style="font-family: 微软雅黑; font-size: 14px; line-height: 21px; widows: auto;"><br style="background-color: inherit;"></div><h2 style="font-family: 微软雅黑;  line-height: 21px; widows: auto;">使用&nbsp;rlwrap 强化 skynet 控制台</h2><div style="font-family: 微软雅黑; font-size: 14px; line-height: 21px; widows: auto;">前面提到了skynet控制台不能使用上下键回溯历史命令，退格键也不能使用等，为了弥补这个不足，可以使用&nbsp;rlwrap</div><div style="font-family: 微软雅黑; font-size: 14px; line-height: 21px; widows: auto;">这里以 centos做说明， rlwrap依赖 readline，系统必须装有 readline ，<span style="widows: auto;">在现有很多linux系统，readline都可自动化安装：</span></div><div style="font-family: 微软雅黑; font-size: 14px; line-height: 21px; widows: auto;"><pre name="code" class="plain" style="width: 100%; overflow: hidden;">yum -y install readline-devel</pre><span style="widows: auto;">rlwrap则需要手动安装，这里附&nbsp;rlwrap下载地址，</span><a target="_blank" href="http://download.csdn.net/detail/cwqcwk1/9394596" style="widows: auto;">点这里</a>。<span style="widows: auto;">安装 rlwrap很简单，如下：</span></div><div style="font-family: 微软雅黑; font-size: 14px; line-height: 21px; widows: auto;"><pre name="code" class="plain" style="width: 100%; overflow: hidden;">tar -zxf rlwrap-0.37.tar.gz 
cd rlwrap-0.37
./configure
make &amp;&amp; make install</pre>以后，skynet控制台的连接方式改成这样，就可以回溯命令了。</div><div style="font-family: 微软雅黑; line-height: 21px; widows: auto;"><table border="1" cellpadding="2" cellspacing="0" style="font-size:undefined; border-collapse: collapse; margin-top: 10px; margin-bottom: 10px; font-family: 微软雅黑; widows: auto; width: 600px;"><tbody style="background-color: inherit;"><tr style="background-color: inherit;"><td valign="top" style="word-break: break-all; border: 1px solid rgb(153, 153, 153); padding: 5px 10px; min-height: 25px; min-width: 25px; height: 25px; background-color: inherit; width: 579px;"><div style="min-width: 2px; background-color: inherit;"><span style="font-size: 14px;">$ rlwrap nc 127.0.0.1 8000</span></div><div style="min-width: 2px; background-color: inherit;"><span style="font-size:14px;">Welcome to skynet console</span></div><div style="min-width: 2px; background-color: inherit;"><span style="font-size:14px;">list</span></div><div style="min-width: 2px; background-color: inherit;"><span style="font-size:14px;">:01000004 &nbsp; &nbsp; &nbsp; snlua cmaster</span></div><div style="min-width: 2px; background-color: inherit;"><span style="font-size:14px;">:01000005 &nbsp; &nbsp; &nbsp; snlua cslave</span></div><div style="min-width: 2px; background-color: inherit;"><span style="font-size:14px;">:01000007 &nbsp; &nbsp; &nbsp; snlua datacenterd</span></div><div style="min-width: 2px; background-color: inherit;"><span style="font-size:14px;">:01000008 &nbsp; &nbsp; &nbsp; snlua service_mgr</span></div><div style="min-width: 2px; background-color: inherit;"><span style="font-size:14px;">:0100000a &nbsp; &nbsp; &nbsp; snlua protoloader</span></div><div style="min-width: 2px; background-color: inherit;"><span style="font-size:14px;">:0100000b &nbsp; &nbsp; &nbsp; snlua console</span></div><div style="min-width: 2px; background-color: inherit;"><span style="font-size:14px;">:0100000c &nbsp; &nbsp; &nbsp; snlua debug_console 8000</span></div><div style="min-width: 2px; background-color: inherit;"><span style="font-size:14px;">:0100000d &nbsp; &nbsp; &nbsp; snlua simpledb</span></div><div style="min-width: 2px; background-color: inherit;"><span style="font-size:14px;">:0100000e &nbsp; &nbsp; &nbsp; snlua watchdog</span></div><div style="min-width: 2px; background-color: inherit;"><span style="font-size:14px;">:0100000f &nbsp; &nbsp; &nbsp; snlua gate</span></div><div style="min-width: 2px; background-color: inherit;"><span style="font-size:14px;">OK</span></div></td></tr></tbody></table>最后，这里列举 rlwrap常用的快捷键：</div><div style="font-family: 微软雅黑; line-height: 21px; widows: auto;">Ctrl+L 清屏，实际是将当前行置顶<br>Ctrl+P 上一条命令<br>Ctrl+N 下一条命令<br>Ctrl+U 从光标处删除到行首<br>Ctrl+W 向前删除一个单词<br>Ctrl+B 光标向前移动一个位置<br>Ctrl+T 光标处字符与前一个字符交换位置<br>Ctrl+Z 后台运行，使用fg调出<br>Ctrl+H 相当于删除键<br>Ctrl+J 相当于回车键<br>Ctrl+O 相当于回车键<br>Ctrl+M 相当于回车键<br></div><div style="font-family: 微软雅黑; line-height: 21px; widows: auto;"><br></div><div style="font-family: 微软雅黑; font-size: 14px; line-height: 21px; widows: auto;">参考：</div><div style="font-family: 微软雅黑; font-size: 14px; line-height: 21px; widows: auto;">[1] <a target="_blank" href="https://github.com/cloudwu/skynet/wiki/DebugConsole">DebugConsole </a>&nbsp; 云风</div><div style="font-family: 微软雅黑; font-size: 14px; line-height: 21px; widows: auto;">[2] <a target="_blank" href="http://blog.csdn.net/mycwq/article/details/50472692">skynet 控制台管理使用技巧</a>&nbsp;没有开花的树</div><div><br></div> </div>

原文：http://blog.csdn.net/mycwq/article/details/50472692