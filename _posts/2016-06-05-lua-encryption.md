---
layout: post
title:  "skynet项目lua代码简单加密"
date:   2016-06-05 16:03:19
categories: skynet
tags: [skynet]
---

<div class="article_c">
<div style="font-family: 微软雅黑; font-size: 14px; line-height: 21px;"><span style="background-color: inherit;">最近在看skynet的代码，总体感觉跟 erlang很像，理念都是基于Actor模型，即万物皆Actor，Actor之间通过发送消息进行通信。（这里说的“万物”倾向于表示有能动作用，有独立行为的个体。）</span></div><div style="font-family: 微软雅黑; font-size: 14px; line-height: 21px;"><span style="background-color: inherit;"><br></span></div><div style="font-family: 微软雅黑; font-size: 14px; line-height: 21px;"><span style="background-color: inherit;">不同的是，</span><span style="background-color: inherit;">skynet使用 c 和 lua实现，这两个语言相较erlang比较流行。</span><span style="background-color: inherit;">skynet的Actor</span><span style="background-color: inherit;">是指skynet服务，skynet<span style="font-family: 微软雅黑; font-size: 14px; line-height: 21px;">服务</span></span><span style="background-color: inherit;">类似erlang进程，调度方式也有点接近，skynet启动时会初始化多个调度线程，用于同时处理多个服务，每个服务都有一定的调度次数约束(处理消息条数)，挂起或达到约束就失去调度权。不过skynet服务的调度不是轮转，而是消息驱动方式（先来消息先调度）。实现上，每个服务都是一个lua state，也就是一个lua虚拟机，效果等同沙箱，实现隔离。另外，lua state本身没有多线程支持的，skynet实现上在一个线程运行多个lua state实例。</span></div><div style="font-family: 微软雅黑; font-size: 14px; line-height: 21px;"><span style="background-color: inherit;"><br></span></div><div style="font-family: 微软雅黑; font-size: 14px; line-height: 21px;"><span style="background-color: inherit;">好了，切入今天的主题吧，skynet项目lua代码加密。文章利用lua编译成二进制实现加密，方法比较简单。</span></div><div style="font-family: 微软雅黑; font-size: 14px; line-height: 21px;"><span style="background-color: inherit;"><br></span></div><h2 style="font-family: 微软雅黑; line-height: 21px;line-height: 1.5;"><span style="background-color: inherit;"><span style="font-size:32px;">lua编译</span></span></h2><div style="font-family: 微软雅黑; font-size: 14px; line-height: 21px;">lua代码可以被编译二进制文件，就是lua可以同时支持源代码加载和二进制加载两种方式。</div><div style="font-family: 微软雅黑; font-size: 14px; line-height: 21px;">但是，lua编译成二进制有一点使用限制，lua二进制支持跨平台，跨版本，但必须在相同字长的机器上。就是说，32位lua编译的二进制不能在64位下使用。另外，虽然官方表示可跨版本，但也声明了跨版本可能存在不兼容的情况，具体情况没有说明。</div><div style="font-family: 微软雅黑; font-size: 14px; line-height: 21px;">另一点，lua代码编译成二进制，不意味着执行更快，这个过程只是预编译，将代码编译成字节码（bytecodes）。因为lua源代码执行前也要生成字节码，所以二进制方式在一定程度上提高了代码加载的速度。</div><div style="font-family: 微软雅黑; font-size: 14px; line-height: 21px;"><br style="background-color: inherit;"></div><div style="font-family: 微软雅黑; font-size: 14px; line-height: 21px;"><br style="background-color: inherit;"></div><h2 style="font-family: 微软雅黑; line-height: 21px;line-height: 1.5;"><span style="font-size:32px;">lua编译器</span></h2><div style="font-family: 微软雅黑; font-size: 14px; line-height: 21px;">luac [ options ] [ filenames<span style="background-color: inherit; line-height: 1.5;">&nbsp;]</span></div><div style="font-family: 微软雅黑; font-size: 14px; line-height: 21px;"><span style="background-color: inherit; line-height: 1.5;">options<span style="background-color: inherit;">&nbsp;说明：</span><br style="background-color: inherit;"></span></div><div style="line-height: 21px;"><table border="1" cellpadding="2" cellspacing="0" style="font-size:undefined; border-collapse: collapse; margin-top: 10px; margin-bottom: 10px; background-color: inherit; width: 599px;"><tbody style="background-color: inherit;"><tr style="background-color: inherit;"><td valign="top" style="word-break: break-all; border: 1px solid rgb(153, 153, 153); padding: 5px 10px; min-height: 25px; min-width: 25px; height: 25px; background-color: inherit; width: 64px;"><div style="min-width: 2px; background-color: inherit;"><span style="font-family:Microsoft YaHei;font-size:14px;">options&nbsp;<br style="background-color: inherit;"></span></div></td><td valign="top" style="word-break: break-all; border: 1px solid rgb(153, 153, 153); padding: 5px 10px; min-height: 25px; min-width: 25px; height: 25px; background-color: inherit; width: 493px;"><span style="font-family:Microsoft YaHei;font-size:14px;">说明</span></td></tr><tr style="background-color: inherit;"><td valign="top" style="word-break: break-all; border: 1px solid rgb(153, 153, 153); padding: 5px 10px; min-height: 25px; min-width: 25px; height: 27px; background-color: inherit; width: 64px;"><div style="min-width: 2px; background-color: inherit;"><span style="font-family:Microsoft YaHei;font-size:14px;">-l</span></div></td><td valign="top" style="word-break: break-all; border: 1px solid rgb(153, 153, 153); padding: 5px 10px; min-height: 25px; min-width: 25px; height: 27px; background-color: inherit; width: 493px;"><div style="min-width: 2px; background-color: inherit;"><span style="font-family:Microsoft YaHei;font-size:14px;">生成lua编译后字节码的可视化数据，这对于学习lua虚拟机很有帮助</span></div></td></tr><tr style="background-color: inherit;"><td valign="top" style="word-break: break-all; border: 1px solid rgb(153, 153, 153); padding: 5px 10px; min-height: 25px; min-width: 25px; height: 25px; background-color: inherit; width: 64px;"><div style="min-width: 2px; background-color: inherit;"><span style="font-family:Microsoft YaHei;font-size:14px;">-o file</span></div></td><td valign="top" style="word-break: break-all; border: 1px solid rgb(153, 153, 153); padding: 5px 10px; min-height: 25px; min-width: 25px; height: 25px; background-color: inherit; width: 493px;"><span style="font-family:Microsoft YaHei;font-size:14px;">编译lua代码，输出文件为file。默认生成 luac.out</span></td></tr><tr style="background-color: inherit;"><td valign="top" style="word-break: break-all; border: 1px solid rgb(153, 153, 153); padding: 5px 10px; min-height: 25px; min-width: 25px; height: 25px; background-color: inherit; width: 64px;"><div style="min-width: 2px; background-color: inherit;"><span style="font-family:Microsoft YaHei;font-size:14px;">-s</span></div></td><td valign="top" style="word-break: break-all; border: 1px solid rgb(153, 153, 153); padding: 5px 10px; min-height: 25px; min-width: 25px; height: 25px; background-color: inherit; width: 493px;"><div style="min-width: 2px; background-color: inherit;"><span style="font-family:Microsoft YaHei;font-size:14px;">写入输出文件时去掉调试信息。可以减少输出文件的大小，但错误信息就比较简单，例如，少了行号和局部变量名</span></div></td></tr><tr style="background-color: inherit;"><td valign="top" style="word-break: break-all; border: 1px solid rgb(153, 153, 153); padding: 5px 10px; min-height: 25px; min-width: 25px; height: 25px; background-color: inherit; width: 64px;"><div style="min-width: 2px; background-color: inherit;"><span style="font-family:Microsoft YaHei;font-size:14px;">-v</span></div></td><td valign="top" style="word-break: break-all; border: 1px solid rgb(153, 153, 153); padding: 5px 10px; min-height: 25px; min-width: 25px; height: 25px; background-color: inherit; width: 493px;"><div style="min-width: 2px; background-color: inherit;"><span style="font-family:Microsoft YaHei;font-size:14px;">显示版本信息</span></div></td></tr></tbody></table><br style="background-color: inherit;"></div><div style="font-family: 微软雅黑; font-size: 14px; line-height: 21px;"><br style="background-color: inherit;"></div><h2 style="font-family: 微软雅黑; line-height: 21px;line-height: 1.5;"><span style="background-color: inherit;"><span style="font-size:32px;">编译skynet项目的lua脚本</span></span></h2><div style="font-family: 微软雅黑; font-size: 14px; line-height: 21px;">skynet没有提供工具来生成，所以这里简单写个脚本演示下。目前skynet没有支持luajit</div><div style="font-family: 微软雅黑; font-size: 14px; line-height: 21px;"><table border="1" cellpadding="2" cellspacing="0" style="font-size:undefined; border-collapse: collapse; margin-top: 10px; margin-bottom: 10px; background-color: inherit; width: 600px;"><tbody style="background-color: inherit;"><tr style="background-color: inherit;"><td valign="top" style="word-break: break-all; border: 1px solid rgb(153, 153, 153); padding: 5px 10px; min-height: 25px; min-width: 25px; height: 25px; background-color: inherit; width: 579px;"><div style="min-width: 2px; background-color: inherit;"><span style="font-family:Microsoft YaHei;font-size:14px;">#!/bin/bash</span></div><div style="min-width: 2px; background-color: inherit;"><span style="font-family:Microsoft YaHei;font-size:14px;"><br style="background-color: inherit;"></span></div><div style="min-width: 2px; background-color: inherit;"><span style="font-family:Microsoft YaHei;font-size:14px;">LUAC=./3rd/lua/luac</span></div><div style="min-width: 2px; background-color: inherit;"><span style="font-family:Microsoft YaHei;font-size:14px;">mkdir -p bin</span></div><div style="min-width: 2px; background-color: inherit;"><span style="font-family:Microsoft YaHei;font-size:14px;"><br style="background-color: inherit;"></span></div><div style="min-width: 2px; background-color: inherit;"><span style="font-family:Microsoft YaHei;font-size:14px;">Luas=`find . -name "*.lua"`</span></div><div style="min-width: 2px; background-color: inherit;"><span style="font-family:Microsoft YaHei;font-size:14px;">for file in $Luas</span></div><div style="min-width: 2px; background-color: inherit;"><span style="font-family:Microsoft YaHei;font-size:14px;">do</span></div><div style="min-width: 2px; background-color: inherit;"><span style="font-family:Microsoft YaHei;font-size:14px;">&nbsp; &nbsp; filename = `basename $file`</span></div><div style="min-width: 2px; background-color: inherit;"><span style="font-family:Microsoft YaHei;font-size:14px;">&nbsp; &nbsp; $LUAC -o bin/$filename $file</span></div><div style="min-width: 2px; background-color: inherit;"><span style="font-family:Microsoft YaHei;font-size:14px;">done</span></div></td></tr></tbody></table></div><div style="font-family: 微软雅黑; font-size: 14px; line-height: 21px;">脚本执行完后，编译后的代码就会输出到 bin 目录。<span style="background-color: inherit; line-height: 1.5;">为了代码能够被执行到，还需要修改配置文件，所有的lua文件都要从bin路径查找。</span></div><div style="font-family: 微软雅黑; font-size: 14px; line-height: 21px;"><span style="background-color: inherit; line-height: 1.5;">以 examples/config 为例</span></div><div style="line-height: 21px;"><table border="1" cellpadding="2" cellspacing="0" style="font-size:undefined; border-collapse: collapse; margin-top: 10px; margin-bottom: 10px; background-color: inherit; width: 600px;"><tbody style="background-color: inherit;"><tr style="background-color: inherit;"><td valign="top" style="word-break: break-all; border: 1px solid rgb(153, 153, 153); padding: 5px 10px; min-height: 25px; min-width: 25px; height: 25px; background-color: inherit; width: 579px;"><div style="min-width: 2px; background-color: inherit;"><span style="font-family:Microsoft YaHei;font-size:14px;">root = "./"</span></div><div style="min-width: 2px; background-color: inherit;"><span style="font-family:Microsoft YaHei;font-size:14px;">thread = 8</span></div><div style="min-width: 2px; background-color: inherit;"><span style="font-family:Microsoft YaHei;font-size:14px;">logger = nil</span></div><div style="min-width: 2px; background-color: inherit;"><span style="font-family:Microsoft YaHei;font-size:14px;">logpath = "."</span></div><div style="min-width: 2px; background-color: inherit;"><span style="font-family:Microsoft YaHei;font-size:14px;">harbor = 1</span></div><div style="min-width: 2px; background-color: inherit;"><span style="font-family:Microsoft YaHei;font-size:14px;">address = "127.0.0.1:2526"</span></div><div style="min-width: 2px; background-color: inherit;"><span style="font-family:Microsoft YaHei;font-size:14px;">master = "127.0.0.1:2013"</span></div><div style="min-width: 2px; background-color: inherit;"><span style="font-family:Microsoft YaHei;font-size:14px;">start = "main"	-- main script</span></div><div style="min-width: 2px; background-color: inherit;"><span style="font-family:Microsoft YaHei;font-size:14px;">bootstrap = "snlua bootstrap"	-- The service for bootstrap</span></div><div style="min-width: 2px; background-color: inherit;"><span style="font-family:Microsoft YaHei;font-size:14px;">standalone = "0.0.0.0:2013"</span></div><div style="min-width: 2px; background-color: inherit;"><span style="color:#ff0000;background-color: inherit;"><span style="font-family:Microsoft YaHei;font-size:14px;">luaservice = root.."bin/?.lua;"</span></span></div><div style="min-width: 2px; background-color: inherit;"><span style="color:#ff0000;background-color: inherit;"><span style="font-family:Microsoft YaHei;font-size:14px;">lualoader = root.."bin/loader.lua"</span></span></div><div style="min-width: 2px; background-color: inherit;"><span style="color:#ff0000;background-color: inherit;"><span style="font-family:Microsoft YaHei;font-size:14px;">snax = root.."bin/?.lua"</span></span></div><div style="min-width: 2px; background-color: inherit;"><span style="font-family:Microsoft YaHei;font-size:14px;">-- snax_interface_g = "snax_g"</span></div><div style="min-width: 2px; background-color: inherit;"><span style="font-family:Microsoft YaHei;font-size:14px;">cpath = root.."cservice/?.so"</span></div><div style="min-width: 2px; background-color: inherit;"><span style="font-family:Microsoft YaHei;font-size:14px;">-- daemon = "./skynet.pid"</span></div></td></tr></tbody></table></div><div style="font-family: 微软雅黑; font-size: 14px; line-height: 21px;"><br style="background-color: inherit;"></div><div style="font-family: 微软雅黑; font-size: 14px; line-height: 21px;"><br></div><h2 style="font-family: 微软雅黑; line-height: 21px;line-height: 1.5;"><span style="background-color: inherit;"><span style="font-size:32px;">lua代码加密的另一种方式</span></span></h2><div style="font-family: 微软雅黑; font-size: 14px; line-height: 21px;">前面介绍了把lua代码编译成二进制达到加密目的，这已经足够了。如果想进一步加密代码，可以使用下面的方法。</div><div style="font-family: 微软雅黑; font-size: 14px; line-height: 21px;">luac编译时，通过以下函数输出到文件，<span style="background-color: inherit; line-height: 1.5;">这里以异或加密为例说明。</span></div><div style="font-family: 微软雅黑; font-size: 14px; line-height: 21px;"><table border="1" cellpadding="2" cellspacing="0" style="font-size:undefined; border-collapse: collapse; margin-top: 10px; margin-bottom: 10px; background-color: inherit; width: 600px;"><tbody style="background-color: inherit;"><tr style="background-color: inherit;"><td valign="top" style="word-break: break-all; border: 1px solid rgb(153, 153, 153); padding: 5px 10px; min-height: 25px; min-width: 25px; height: 25px; background-color: inherit; width: 579px;"><div style="min-width: 2px; background-color: inherit;"><div style="font-family: 微软雅黑; font-size: 14px;">// luac.c</div><div style="font-family: 微软雅黑; font-size: 14px;"><br style="background-color: inherit;"></div><div style="font-family: 微软雅黑; font-size: 14px;">static int writer(lua_State* L, const void* p, size_t size, void* u)</div><div style="font-family: 微软雅黑; font-size: 14px;">{</div><div style="font-family: 微软雅黑; font-size: 14px;"><span style="color:#ff0000;background-color: inherit;">&nbsp;int ret = !0;</span></div><div style="font-family: 微软雅黑; font-size: 14px;"><span style="color:#ff0000;background-color: inherit;">&nbsp;size_t i =0;</span></div><div style="font-family: 微软雅黑; font-size: 14px;"><span style="color:#ff0000;background-color: inherit;">&nbsp;char* pp = (char *)malloc(sizeof(char*)*size);&nbsp;</span></div><div style="font-family: 微软雅黑; font-size: 14px;">&nbsp;UNUSED(L);</div><div style="font-family: 微软雅黑; font-size: 14px;"><span style="color:#ff0000;background-color: inherit;">&nbsp;memcpy(pp, p, size);</span></div><div style="font-family: 微软雅黑; font-size: 14px;"><span style="color:#ff0000;background-color: inherit;">&nbsp;for(;i&lt;size;i++) pp[i] ^=250;</span></div><div style="font-family: 微软雅黑; font-size: 14px;">&nbsp;ret =&nbsp;(fwrite(<span style="color:#ff0000;background-color: inherit;">(void*)pp</span>,size,1,(FILE*)u)!=1) &amp;&amp; (size!=0);</div><div style="font-family: 微软雅黑; font-size: 14px;">&nbsp;<span style="color:#ff0000;background-color: inherit;">free(pp);</span></div><div style="font-family: 微软雅黑; font-size: 14px;">&nbsp;return ret;</div><div style="font-family: 微软雅黑; font-size: 14px;">}</div></div></td></tr></tbody></table></div><div style="font-family: 微软雅黑; font-size: 14px; line-height: 21px;">lua执行代码也要相应做修改，否则无法执行。</div><div style="font-family: 微软雅黑; font-size: 14px; line-height: 21px;"><table border="1" cellpadding="2" cellspacing="0" style="font-size:undefined; border-collapse: collapse; margin-top: 10px; margin-bottom: 10px; background-color: inherit; width: 600px;"><tbody style="background-color: inherit;"><tr style="background-color: inherit;"><td valign="top" style="word-break: break-all; border: 1px solid rgb(153, 153, 153); padding: 5px 10px; min-height: 25px; min-width: 25px; height: 25px; background-color: inherit; width: 579px;"><div style="min-width: 2px; background-color: inherit;"><span style="font-family:Microsoft YaHei;font-size:14px;">//lauxlib.c</span></div><div style="min-width: 2px; background-color: inherit;"><span style="font-family:Microsoft YaHei;font-size:14px;"><br style="background-color: inherit;"></span></div><div style="min-width: 2px; background-color: inherit;"><span style="font-family:Microsoft YaHei;font-size:14px;">static const char *getF (lua_State *L, void *ud, size_t *size) {</span></div><div style="min-width: 2px; background-color: inherit;"><span style="font-family:Microsoft YaHei;font-size:14px;">&nbsp; LoadF *lf = (LoadF *)ud;</span></div><div style="min-width: 2px; background-color: inherit;"><span style="font-family:Microsoft YaHei;font-size:14px;">&nbsp; (void)L; &nbsp;/* not used */</span></div><div style="min-width: 2px; background-color: inherit;"><span style="font-family:Microsoft YaHei;font-size:14px;">&nbsp; if (lf-&gt;n &gt; 0) { &nbsp;/* are there pre-read characters to be read? */</span></div><div style="min-width: 2px; background-color: inherit;"><span style="font-family:Microsoft YaHei;font-size:14px;">&nbsp; &nbsp; *size = lf-&gt;n; &nbsp;/* return them (chars already in buffer) */</span></div><div style="min-width: 2px; background-color: inherit;"><span style="font-family:Microsoft YaHei;font-size:14px;">&nbsp; &nbsp; lf-&gt;n = 0; &nbsp;/* no more pre-read characters */</span></div><div style="min-width: 2px; background-color: inherit;"><span style="font-family:Microsoft YaHei;font-size:14px;">&nbsp; }</span></div><div style="min-width: 2px; background-color: inherit;"><span style="font-family:Microsoft YaHei;font-size:14px;">&nbsp; else { &nbsp;/* read a block from file */</span></div><div style="min-width: 2px; background-color: inherit;"><span style="font-family:Microsoft YaHei;font-size:14px;">&nbsp; &nbsp; /* 'fread' can return &gt; 0 *and* set the EOF flag. If next call to</span></div><div style="min-width: 2px; background-color: inherit;"><span style="font-family:Microsoft YaHei;font-size:14px;">&nbsp; &nbsp; &nbsp; &nbsp;'getF' called 'fread', it might still wait for user input.</span></div><div style="min-width: 2px; background-color: inherit;"><span style="font-family:Microsoft YaHei;font-size:14px;">&nbsp; &nbsp; &nbsp; &nbsp;The next check avoids this problem. */</span></div><div style="min-width: 2px; background-color: inherit;"><span style="font-family:Microsoft YaHei;font-size:14px;">&nbsp; &nbsp; if (feof(lf-&gt;f)) return NULL;</span></div><div style="min-width: 2px; background-color: inherit;"><span style="font-family:Microsoft YaHei;font-size:14px;">&nbsp; &nbsp; *size = fread(lf-&gt;buff, 1, sizeof(lf-&gt;buff), lf-&gt;f); &nbsp;/* read block */</span></div><div style="min-width: 2px; background-color: inherit;"><span style="font-family:Microsoft YaHei;font-size:14px;">&nbsp; }</span></div><div style="min-width: 2px; background-color: inherit;"><span style="font-family:Microsoft YaHei;font-size:14px;">&nbsp;&nbsp;<span style="color:#ff0000;background-color: inherit;">do{size_t i=0; for(;i&lt;*size;) lf-&gt;buff[i++] ^= 250;}while(0);</span></span></div><div style="min-width: 2px; background-color: inherit;"><span style="font-family:Microsoft YaHei;font-size:14px;">&nbsp; return lf-&gt;buff;</span></div><div style="min-width: 2px; background-color: inherit;"><span style="font-family:Microsoft YaHei;font-size:14px;">}</span></div></td></tr></tbody></table></div><div style="font-family: 微软雅黑; font-size: 14px; line-height: 21px;">这样就可以了，但是要注意了，不能同时修改以上两处内容，编译和执行要分开处理，否则无法编译lua代码。（skynet版本不同，代码可以不同，仅参考）</div><div style="font-family: 微软雅黑; font-size: 14px; line-height: 21px;"><br style="background-color: inherit;"></div><div style="font-family: 微软雅黑; font-size: 14px; line-height: 21px;"><br style="background-color: inherit;"></div><h2 style="font-family: 微软雅黑; line-height: 21px;line-height: 1.5;"><span style="background-color: inherit;"><span style="font-size:32px;">luajit编译</span></span></h2><div style="font-family: 微软雅黑; font-size: 14px; line-height: 21px;">按照skynet的计划，lua有可能换上luajit。luajit也支持二进制编译，lua代码加密方式类似。</div><div style="font-family: 微软雅黑; font-size: 14px; line-height: 21px;">luajit -b filename newfile</div><div style="line-height: 21px;"><table border="1" cellpadding="2" cellspacing="0" style="border-collapse: collapse; margin-top: 10px; margin-bottom: 10px; widows: auto; width: 600px;"><tbody style="background-color: inherit;"><tr style="background-color: inherit;"><td valign="top" style="word-break: break-all; border: 1px solid rgb(153, 153, 153); padding: 5px 16px 5px 12px; min-height: 25px; min-width: 25px; height: 25px; background-color: inherit; width: 579px;"><div style="min-width: 2px; background-color: inherit;"><span style="font-family: 'Microsoft YaHei';"><span style="font-size:14px;">luajit -b test.lua test.out &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # Save bytecode to test.out</span></span></div><div style="min-width: 2px; background-color: inherit;"><span style="font-family: 'Microsoft YaHei';"><span style="font-size:14px;">luajit -bs test.lua test.out &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # As above, Strip debug info (default).</span></span></div><div style="min-width: 2px; background-color: inherit;"><span style="font-family: 'Microsoft YaHei';"><span style="font-size:14px;">luajit -bg test.lua test.out &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# Keep debug info</span></span></div><div style="min-width: 2px; background-color: inherit;"><span style="font-family: 'Microsoft YaHei';"><span style="font-size:14px;">luajit -be "print('hello world')" test.out &nbsp;# Save cmdline script</span></span></div><div style="min-width: 2px; background-color: inherit;"></div><div style="min-width: 2px; background-color: inherit;"><span style="font-family: 'Microsoft YaHei';"><span style="font-size:14px;">luajit -bl test.lua &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # List to stdout</span></span></div><div style="min-width: 2px; background-color: inherit;"><span style="font-family: 'Microsoft YaHei';"><span style="font-size:14px;">luajit -bl test.lua test.txt &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # List to test.txt</span></span></div><div style="min-width: 2px; background-color: inherit;"><span style="font-family: 'Microsoft YaHei';"><span style="font-size:14px;">luajit -ble "print('hello world')" &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# List cmdline script</span></span></div></td></tr></tbody></table><br></div><h2 style="font-family: 微软雅黑; line-height: 21px;line-height: 1.5;"><span style="font-size:32px;">最后语</span></h2><div style="font-family: 微软雅黑; font-size: 14px; line-height: 21px;">最后回顾下，文章利用lua编译成二进制实现加密，编译成字节码，可直接被lua加载，比较实用。比较之下，改编译器代码不是很适用，这里只是提供可能的思路。</div><div style="font-family: 微软雅黑; font-size: 14px; line-height: 21px;">好了，今天就到这里。再研究下skynet的实现，继续做分享。</div><div style="font-family: 微软雅黑; font-size: 14px; line-height: 21px;"><br></div><div style="font-family: 微软雅黑; font-size: 14px; line-height: 21px;">参考：http://blog.csdn.net/mycwq/article/details/47406337</div> </div>

原文：http://blog.csdn.net/mycwq/article/details/47406337